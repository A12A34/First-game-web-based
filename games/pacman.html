<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pac-Man - Game Hub</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        canvas {
            border: 3px solid #2121de;
            border-radius: 5px;
            background: #000;
        }
        .stats-bar {
            display: flex;
            gap: 30px;
        }
        .stat-box {
            text-align: center;
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
        }
        .stat-value.score { color: #ffff00; }
        .stat-value.lives { color: #ff6b6b; }
        .stat-value.level { color: #00ff88; }
        .stat-label {
            font-size: 0.8rem;
            color: #888;
        }
        .controls-hint {
            color: #888;
            font-size: 0.9rem;
        }
        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <button id="fullscreenBtn" class="fullscreen-btn" title="Toggle Fullscreen">‚õ∂</button>
    <div class="container">
        <a href="../index.html" class="back-btn">‚Üê Back to Games</a>
        
        <div class="game-container">
            <h1 class="game-title">üëª Pac-Man</h1>
            
            <div class="game-area">
                <div class="stats-bar">
                    <div class="stat-box">
                        <div class="stat-value score" id="score">0</div>
                        <div class="stat-label">Score</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value lives" id="lives">3</div>
                        <div class="stat-label">Lives</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value level" id="level">1</div>
                        <div class="stat-label">Level</div>
                    </div>
                </div>
                
                <canvas id="gameCanvas" width="420" height="460"></canvas>
                
                <p class="controls-hint">Arrow keys to move</p>
                
                <button id="startBtn" class="btn btn-primary">Start Game</button>
            </div>
            
            <div class="instructions">
                <h3>How to Play</h3>
                <p>Eat all the dots while avoiding ghosts! Power pellets let you eat the ghosts for bonus points.</p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const TILE = 20;
        const COLS = 21;
        const ROWS = 23;
        
        // 0 = empty, 1 = wall, 2 = dot, 3 = power pellet, 4 = empty (eaten)
        const MAP = [
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
            [1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1],
            [1,3,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,3,1],
            [1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
            [1,2,1,1,2,1,2,1,1,1,1,1,1,1,2,1,2,1,1,2,1],
            [1,2,2,2,2,1,2,2,2,2,1,2,2,2,2,1,2,2,2,2,1],
            [1,1,1,1,2,1,1,1,0,0,0,0,0,1,1,1,2,1,1,1,1],
            [0,0,0,1,2,1,0,0,0,0,0,0,0,0,0,1,2,1,0,0,0],
            [1,1,1,1,2,1,0,1,1,0,0,0,1,1,0,1,2,1,1,1,1],
            [0,0,0,0,2,0,0,1,0,0,0,0,0,1,0,0,2,0,0,0,0],
            [1,1,1,1,2,1,0,1,1,1,1,1,1,1,0,1,2,1,1,1,1],
            [0,0,0,1,2,1,0,0,0,0,0,0,0,0,0,1,2,1,0,0,0],
            [1,1,1,1,2,1,0,1,1,1,1,1,1,1,0,1,2,1,1,1,1],
            [1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1],
            [1,2,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,2,1],
            [1,3,2,1,2,2,2,2,2,2,0,2,2,2,2,2,2,1,2,3,1],
            [1,1,2,1,2,1,2,1,1,1,1,1,1,1,2,1,2,1,2,1,1],
            [1,2,2,2,2,1,2,2,2,2,1,2,2,2,2,1,2,2,2,2,1],
            [1,2,1,1,1,1,1,1,2,1,1,1,2,1,1,1,1,1,1,2,1],
            [1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],
            [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
        ];
        
        let map = [];
        let pacman = { x: 10, y: 15, dir: 0, nextDir: 0, mouthOpen: true };
        let ghosts = [];
        let score = 0;
        let lives = 3;
        let level = 1;
        let gameRunning = false;
        let powerMode = false;
        let powerTimer = null;

        const GHOST_COLORS = ['#ff0000', '#00ffff', '#ffb8ff', '#ffb852'];

        function init() {
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);
            
            document.addEventListener('keydown', handleKey);
            drawStartScreen();
        }

        function handleKey(e) {
            if (!gameRunning) return;
            
            const dirs = { 'ArrowRight': 0, 'ArrowDown': 1, 'ArrowLeft': 2, 'ArrowUp': 3 };
            if (dirs[e.key] !== undefined) {
                e.preventDefault();
                pacman.nextDir = dirs[e.key];
            }
        }

        function startGame() {
            map = JSON.parse(JSON.stringify(MAP));
            pacman = { x: 10, y: 15, dir: 0, nextDir: 0, mouthOpen: true };
            ghosts = [
                { x: 10, y: 9, dir: 3, color: GHOST_COLORS[0], scared: false },
                { x: 9, y: 9, dir: 0, color: GHOST_COLORS[1], scared: false },
                { x: 11, y: 9, dir: 2, color: GHOST_COLORS[2], scared: false },
                { x: 10, y: 8, dir: 1, color: GHOST_COLORS[3], scared: false }
            ];
            score = 0;
            lives = 3;
            level = 1;
            gameRunning = true;
            powerMode = false;
            
            document.getElementById('startBtn').textContent = 'Playing...';
            document.getElementById('startBtn').disabled = true;
            updateDisplay();
            
            gameLoop();
        }

        function gameLoop() {
            if (!gameRunning) return;
            
            update();
            draw();
            
            setTimeout(() => requestAnimationFrame(gameLoop), 150 - level * 10);
        }

        function update() {
            // Try new direction first
            const dx = [1, 0, -1, 0];
            const dy = [0, 1, 0, -1];
            
            let newX = pacman.x + dx[pacman.nextDir];
            let newY = pacman.y + dy[pacman.nextDir];
            
            // Wrap around
            if (newX < 0) newX = COLS - 1;
            if (newX >= COLS) newX = 0;
            
            if (newY >= 0 && newY < map.length && map[newY] && map[newY][newX] !== 1) {
                pacman.dir = pacman.nextDir;
                pacman.x = newX;
                pacman.y = newY;
            } else {
                // Try current direction
                newX = pacman.x + dx[pacman.dir];
                newY = pacman.y + dy[pacman.dir];
                if (newX < 0) newX = COLS - 1;
                if (newX >= COLS) newX = 0;
                
                if (newY >= 0 && newY < map.length && map[newY] && map[newY][newX] !== 1) {
                    pacman.x = newX;
                    pacman.y = newY;
                }
            }
            
            pacman.mouthOpen = !pacman.mouthOpen;
            
            // Eat dots
            if (map[pacman.y] && map[pacman.y][pacman.x] === 2) {
                map[pacman.y][pacman.x] = 4;
                score += 10;
            } else if (map[pacman.y] && map[pacman.y][pacman.x] === 3) {
                map[pacman.y][pacman.x] = 4;
                score += 50;
                activatePowerMode();
            }
            
            // Move ghosts
            ghosts.forEach(ghost => {
                ghost.scared = powerMode;
                moveGhost(ghost);
            });
            
            // Check ghost collision
            for (const ghost of ghosts) {
                if (Math.abs(ghost.x - pacman.x) < 1 && Math.abs(ghost.y - pacman.y) < 1) {
                    if (powerMode) {
                        // Eat ghost
                        ghost.x = 10;
                        ghost.y = 9;
                        score += 200;
                    } else {
                        die();
                        return;
                    }
                }
            }
            
            // Check win
            let dotsLeft = 0;
            for (const row of map) {
                for (const cell of row) {
                    if (cell === 2 || cell === 3) dotsLeft++;
                }
            }
            
            if (dotsLeft === 0) {
                level++;
                map = JSON.parse(JSON.stringify(MAP));
                pacman.x = 10;
                pacman.y = 15;
                updateDisplay();
            }
            
            updateDisplay();
        }

        function moveGhost(ghost) {
            const dx = [1, 0, -1, 0];
            const dy = [0, 1, 0, -1];
            
            // Simple AI: random valid direction with bias toward or away from pacman
            const validDirs = [];
            for (let d = 0; d < 4; d++) {
                const nx = ghost.x + dx[d];
                const ny = ghost.y + dy[d];
                if (ny >= 0 && ny < map.length && map[ny] && map[ny][nx] !== 1) {
                    // Avoid reversing
                    if (d !== (ghost.dir + 2) % 4) {
                        validDirs.push(d);
                    }
                }
            }
            
            if (validDirs.length > 0) {
                // Bias toward/away from pacman
                if (Math.random() > 0.3) {
                    let bestDir = validDirs[0];
                    let bestDist = Infinity;
                    
                    for (const d of validDirs) {
                        const nx = ghost.x + dx[d];
                        const ny = ghost.y + dy[d];
                        const dist = Math.abs(nx - pacman.x) + Math.abs(ny - pacman.y);
                        
                        if (ghost.scared ? dist > bestDist : dist < bestDist) {
                            bestDist = dist;
                            bestDir = d;
                        }
                    }
                    ghost.dir = bestDir;
                } else {
                    ghost.dir = validDirs[Math.floor(Math.random() * validDirs.length)];
                }
                
                ghost.x += dx[ghost.dir];
                ghost.y += dy[ghost.dir];
            }
        }

        function activatePowerMode() {
            powerMode = true;
            clearTimeout(powerTimer);
            powerTimer = setTimeout(() => {
                powerMode = false;
            }, 8000);
        }

        function die() {
            lives--;
            updateDisplay();
            
            if (lives <= 0) {
                gameOver();
            } else {
                pacman.x = 10;
                pacman.y = 15;
                ghosts.forEach((g, i) => {
                    g.x = 9 + i;
                    g.y = 9;
                });
            }
        }

        function draw() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw map
            for (let y = 0; y < map.length; y++) {
                for (let x = 0; x < COLS; x++) {
                    const cell = map[y][x];
                    const px = x * TILE;
                    const py = y * TILE;
                    
                    if (cell === 1) {
                        ctx.fillStyle = '#2121de';
                        ctx.fillRect(px, py, TILE, TILE);
                    } else if (cell === 2) {
                        ctx.fillStyle = '#ffb8ae';
                        ctx.beginPath();
                        ctx.arc(px + TILE/2, py + TILE/2, 3, 0, Math.PI * 2);
                        ctx.fill();
                    } else if (cell === 3) {
                        ctx.fillStyle = '#ffb8ae';
                        ctx.beginPath();
                        ctx.arc(px + TILE/2, py + TILE/2, 8, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
            }
            
            // Draw Pac-Man
            ctx.fillStyle = '#ffff00';
            ctx.beginPath();
            const px = pacman.x * TILE + TILE/2;
            const py = pacman.y * TILE + TILE/2;
            const angle = pacman.dir * Math.PI / 2;
            const mouth = pacman.mouthOpen ? 0.3 : 0.05;
            ctx.arc(px, py, TILE/2 - 2, angle + mouth, angle + Math.PI * 2 - mouth);
            ctx.lineTo(px, py);
            ctx.fill();
            
            // Draw ghosts
            ghosts.forEach(ghost => {
                ctx.fillStyle = ghost.scared ? '#0000ff' : ghost.color;
                const gx = ghost.x * TILE;
                const gy = ghost.y * TILE;
                
                // Body
                ctx.beginPath();
                ctx.arc(gx + TILE/2, gy + TILE/2, TILE/2 - 2, Math.PI, 0);
                ctx.lineTo(gx + TILE - 2, gy + TILE - 2);
                for (let i = 0; i < 3; i++) {
                    const bx = gx + TILE - 2 - i * (TILE/3);
                    ctx.lineTo(bx - TILE/6, gy + TILE - 6);
                    ctx.lineTo(bx - TILE/3, gy + TILE - 2);
                }
                ctx.closePath();
                ctx.fill();
                
                // Eyes
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(gx + TILE/3, gy + TILE/2 - 2, 4, 0, Math.PI * 2);
                ctx.arc(gx + TILE * 2/3, gy + TILE/2 - 2, 4, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(gx + TILE/3 + 1, gy + TILE/2 - 1, 2, 0, Math.PI * 2);
                ctx.arc(gx + TILE * 2/3 + 1, gy + TILE/2 - 1, 2, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawStartScreen() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#ffff00';
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üëª PAC-MAN üëª', canvas.width / 2, canvas.height / 2 - 20);
            ctx.fillStyle = '#fff';
            ctx.font = '16px Arial';
            ctx.fillText('Press Start to Play', canvas.width / 2, canvas.height / 2 + 20);
            ctx.textAlign = 'left';
        }

        function gameOver() {
            gameRunning = false;
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#ff0000';
            ctx.font = '30px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 20);
            ctx.fillStyle = '#fff';
            ctx.font = '20px Arial';
            ctx.fillText(`Score: ${score}`, canvas.width / 2, canvas.height / 2 + 20);
            ctx.textAlign = 'left';
            
            document.getElementById('startBtn').textContent = 'Play Again';
            document.getElementById('startBtn').disabled = false;
        }

        function updateDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('lives').textContent = lives;
            document.getElementById('level').textContent = level;
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        init();
    </script>
</body>
</html>
