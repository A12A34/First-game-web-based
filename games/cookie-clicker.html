<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cookie Clicker - Game Hub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            overflow-x: hidden;
        }
        .clicker-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            padding: 10px;
        }
        .cookie-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .cookie {
            font-size: clamp(100px, 25vw, 180px);
            cursor: pointer;
            transition: transform 0.1s;
            user-select: none;
            position: relative;
            z-index: 2;
            filter: drop-shadow(0 0 20px rgba(255, 193, 7, 0.3));
            animation: cookie-pulse 2s ease-in-out infinite;
            touch-action: manipulation;
        }
        @keyframes cookie-pulse {
            0%, 100% { filter: drop-shadow(0 0 20px rgba(255, 193, 7, 0.3)); }
            50% { filter: drop-shadow(0 0 40px rgba(255, 193, 7, 0.6)); }
        }
        .cookie:hover {
            transform: scale(1.05);
        }
        .cookie:active {
            transform: scale(0.95);
            animation: none;
        }
        .cookie-glow {
            position: absolute;
            width: clamp(150px, 30vw, 250px);
            height: clamp(150px, 30vw, 250px);
            background: radial-gradient(circle, rgba(255, 193, 7, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            animation: glow-rotate 10s linear infinite;
            z-index: 1;
        }
        @keyframes glow-rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .milk-layer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 0%;
            background: linear-gradient(to top, rgba(255, 255, 255, 0.3), transparent);
            border-radius: 0 0 20px 20px;
            pointer-events: none;
            transition: height 0.5s ease;
        }
        .cookie-count {
            font-size: clamp(1.5rem, 5vw, 3rem);
            font-weight: bold;
            color: #ffc107;
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
            text-align: center;
            word-break: break-word;
        }
        .per-second {
            font-size: clamp(0.8rem, 2.5vw, 1rem);
            color: #888;
        }
        .multiplier-info {
            font-size: clamp(0.75rem, 2vw, 0.9rem);
            color: #ff6b6b;
            margin-top: 5px;
            text-align: center;
        }
        .sugar-lump-display {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            color: #e91e63;
            cursor: pointer;
            padding: 8px 15px;
            background: rgba(233, 30, 99, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(233, 30, 99, 0.3);
        }
        .sugar-lump-display:hover {
            background: rgba(233, 30, 99, 0.2);
        }
        .game-layout {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
        }
        @media (max-width: 900px) {
            .game-layout {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }
        .main-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .panel-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .panel-title {
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            font-weight: bold;
            color: #ffc107;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        .panel-title .toggle-icon {
            margin-left: auto;
            transition: transform 0.3s;
        }
        .panel-section.collapsed .panel-content {
            display: none;
        }
        .panel-section.collapsed .toggle-icon {
            transform: rotate(-90deg);
        }
        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        .tab-btn {
            padding: 8px 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: clamp(0.7rem, 2vw, 0.85rem);
            flex: 1;
            min-width: 60px;
            text-align: center;
        }
        .tab-btn:hover {
            border-color: #ffc107;
        }
        .tab-btn.active {
            background: #ffc107;
            color: #000;
            border-color: #ffc107;
        }
        .buy-amount-toggle {
            display: flex;
            gap: 5px;
            margin-bottom: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .buy-btn {
            padding: 8px 12px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            font-size: clamp(0.7rem, 2vw, 0.85rem);
            min-width: 45px;
        }
        .buy-btn:hover {
            border-color: #ffc107;
        }
        .buy-btn.active {
            background: #ffc107;
            color: #000;
            border-color: #ffc107;
        }
        .upgrades {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 350px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        .upgrade {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: grid;
            grid-template-columns: 35px 1fr auto;
            gap: 8px;
            align-items: center;
            touch-action: manipulation;
        }
        .upgrade:hover:not(.locked) {
            border-color: #ffc107;
            transform: translateX(5px);
            background: rgba(255, 193, 7, 0.1);
        }
        @media (hover: none) {
            .upgrade:hover:not(.locked) {
                transform: none;
            }
            .upgrade:active:not(.locked) {
                transform: scale(0.98);
                background: rgba(255, 193, 7, 0.2);
            }
        }
        .upgrade.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .upgrade.affordable {
            border-color: rgba(0, 255, 136, 0.5);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.2);
        }
        .upgrade-icon {
            font-size: clamp(1.4rem, 4vw, 1.8rem);
        }
        .upgrade-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
            min-width: 0;
        }
        .upgrade-name {
            font-size: clamp(0.8rem, 2.5vw, 1rem);
            font-weight: bold;
            color: #fff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .upgrade-cost {
            color: #ffc107;
            font-size: clamp(0.7rem, 2vw, 0.85rem);
        }
        .upgrade-desc {
            font-size: clamp(0.65rem, 1.8vw, 0.75rem);
            color: #888;
        }
        .upgrade-right {
            text-align: right;
        }
        .upgrade-owned {
            color: #00ff88;
            font-weight: bold;
            font-size: clamp(1rem, 3vw, 1.2rem);
        }
        .upgrade-production {
            font-size: clamp(0.65rem, 1.8vw, 0.75rem);
            color: #888;
        }
        .click-effect {
            position: fixed;
            pointer-events: none;
            animation: float-up 1s ease-out forwards;
            font-size: clamp(1rem, 3vw, 1.5rem);
            font-weight: bold;
            color: #ffc107;
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.8);
            z-index: 1000;
        }
        @keyframes float-up {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            50% { transform: translateY(-30px) scale(1.2); }
            100% { opacity: 0; transform: translateY(-60px) scale(0.8); }
        }
        .cookie-crumb {
            position: fixed;
            pointer-events: none;
            font-size: 1rem;
            animation: crumb-fall 1s ease-in forwards;
            z-index: 999;
        }
        @keyframes crumb-fall {
            0% { opacity: 1; transform: translateY(0) rotate(0deg); }
            100% { opacity: 0; transform: translateY(100px) rotate(360deg); }
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        .stat-box {
            text-align: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        .stat-value { color: #00ff88; font-weight: bold; font-size: clamp(0.9rem, 2.5vw, 1.1rem); }
        .stat-label { font-size: clamp(0.6rem, 1.8vw, 0.7rem); color: #888; }
        .golden-cookie {
            position: fixed;
            font-size: clamp(40px, 10vw, 60px);
            cursor: pointer;
            animation: golden-shimmer 0.5s ease-in-out infinite alternate, golden-float 3s ease-in-out infinite;
            z-index: 1001;
            filter: drop-shadow(0 0 20px gold);
            transition: transform 0.2s;
            touch-action: manipulation;
        }
        .golden-cookie:hover, .golden-cookie:active {
            transform: scale(1.2);
        }
        @keyframes golden-shimmer {
            from { filter: drop-shadow(0 0 20px gold) brightness(1); }
            to { filter: drop-shadow(0 0 40px gold) brightness(1.3); }
        }
        @keyframes golden-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        .golden-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(1.2rem, 4vw, 2rem);
            font-weight: bold;
            color: gold;
            text-shadow: 0 0 20px gold;
            animation: golden-announce 2s ease-out forwards;
            z-index: 1002;
            text-align: center;
            pointer-events: none;
            padding: 20px;
            max-width: 90vw;
        }
        @keyframes golden-announce {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            80% { opacity: 1; }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }
        /* Wrinkler styles */
        .wrinkler {
            position: absolute;
            font-size: 40px;
            cursor: pointer;
            animation: wrinkler-suck 2s ease-in-out infinite;
            filter: drop-shadow(0 0 10px rgba(139, 69, 19, 0.5));
            transition: transform 0.2s;
            z-index: 10;
        }
        .wrinkler:hover {
            transform: scale(1.3);
            filter: drop-shadow(0 0 20px rgba(255, 0, 0, 0.8));
        }
        @keyframes wrinkler-suck {
            0%, 100% { transform: scale(1) rotate(-5deg); }
            50% { transform: scale(1.1) rotate(5deg); }
        }
        .wrinkler-pop {
            position: fixed;
            pointer-events: none;
            font-size: 1.2rem;
            font-weight: bold;
            color: #8b4513;
            animation: wrinkler-pop-anim 1.5s ease-out forwards;
            z-index: 1000;
        }
        @keyframes wrinkler-pop-anim {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0; transform: scale(2) translateY(-50px); }
        }
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(36px, 1fr));
            gap: 6px;
        }
        .achievement {
            width: 36px;
            height: 36px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            filter: grayscale(1) opacity(0.3);
            transition: all 0.3s;
            cursor: help;
            position: relative;
        }
        .achievement.unlocked {
            filter: none;
            box-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
        }
        .achievement:hover::after {
            content: attr(data-name);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.65rem;
            white-space: nowrap;
            z-index: 100;
        }
        .achievement-popup {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ffc107, #ff9800);
            color: #000;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            animation: achievement-slide 3s ease-in-out forwards;
            z-index: 1003;
            box-shadow: 0 5px 20px rgba(255, 193, 7, 0.5);
            font-size: clamp(0.8rem, 2.5vw, 1rem);
            max-width: 90vw;
        }
        @keyframes achievement-slide {
            0% { transform: translateX(100%); opacity: 0; }
            10% { transform: translateX(0); opacity: 1; }
            90% { transform: translateX(0); opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .prestige-btn {
            background: linear-gradient(135deg, #9c27b0, #673ab7);
            border: none;
            color: #fff;
            padding: 10px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            width: 100%;
            font-size: clamp(0.8rem, 2.5vw, 1rem);
            touch-action: manipulation;
        }
        .prestige-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(156, 39, 176, 0.5);
        }
        .prestige-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .prestige-info {
            font-size: clamp(0.7rem, 2vw, 0.8rem);
            color: #888;
            margin-top: 8px;
            text-align: center;
        }
        .heavenly-chips {
            color: #e040fb;
            font-weight: bold;
        }
        .fullscreen-btn, .sound-btn, .settings-btn {
            position: fixed;
            top: 15px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: clamp(1rem, 3vw, 1.5rem);
            transition: all 0.3s;
            touch-action: manipulation;
        }
        .fullscreen-btn:hover, .sound-btn:hover, .settings-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        .fullscreen-btn { right: 15px; }
        .sound-btn { right: 55px; }
        .settings-btn { right: 95px; }
        @media (max-width: 600px) {
            .fullscreen-btn { right: 10px; top: 10px; }
            .sound-btn { right: 50px; top: 10px; }
            .settings-btn { right: 90px; top: 10px; }
        }
        .frenzy-active {
            animation: frenzy-bg 0.5s ease-in-out infinite alternate;
        }
        @keyframes frenzy-bg {
            from { background-color: rgba(255, 193, 7, 0.1); }
            to { background-color: rgba(255, 193, 7, 0.2); }
        }
        /* Building Upgrades */
        .building-upgrades-section {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
            justify-content: center;
        }
        .building-upgrade {
            width: 45px;
            height: 45px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            position: relative;
        }
        .building-upgrade:hover:not(.locked):not(.purchased) {
            border-color: #ffc107;
            transform: scale(1.1);
        }
        .building-upgrade.locked {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .building-upgrade.purchased {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }
        .building-upgrade:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.95);
            color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 0.7rem;
            white-space: nowrap;
            z-index: 100;
            max-width: 200px;
            white-space: normal;
            text-align: center;
        }
        .click-upgrades-section {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 12px;
            justify-content: center;
        }
        .click-upgrade {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            min-width: 80px;
            touch-action: manipulation;
        }
        .click-upgrade:hover:not(.locked):not(.purchased) {
            border-color: #ffc107;
            transform: scale(1.05);
        }
        .click-upgrade.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .click-upgrade.purchased {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }
        .news-ticker {
            background: rgba(0, 0, 0, 0.3);
            padding: 8px 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            overflow: hidden;
            white-space: nowrap;
        }
        .news-text {
            display: inline-block;
            animation: ticker 15s linear infinite;
            color: #ffc107;
            font-size: clamp(0.75rem, 2vw, 0.9rem);
        }
        @keyframes ticker {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        .progress-bar {
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            margin-top: 5px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffc107, #ff9800);
            transition: width 0.3s;
        }
        .buttons-row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .btn-small {
            padding: 8px 12px;
            font-size: clamp(0.7rem, 2vw, 0.85rem);
            touch-action: manipulation;
        }
        /* Season indicator */
        .season-indicator {
            position: fixed;
            top: 60px;
            right: 15px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            z-index: 999;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        .season-indicator:hover {
            background: rgba(0, 0, 0, 0.9);
        }
        /* Mobile bottom navigation */
        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.95);
            padding: 10px;
            z-index: 1000;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .mobile-nav-items {
            display: flex;
            justify-content: space-around;
            gap: 5px;
        }
        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: #888;
            font-size: 0.7rem;
            flex: 1;
            touch-action: manipulation;
        }
        .mobile-nav-item.active {
            color: #ffc107;
            background: rgba(255, 193, 7, 0.1);
        }
        .mobile-nav-item span:first-child {
            font-size: 1.3rem;
        }
        @media (max-width: 768px) {
            .mobile-nav {
                display: block;
            }
            body {
                padding-bottom: 80px;
            }
            .side-panel {
                display: none;
            }
            .side-panel.mobile-visible {
                display: flex;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 70px;
                z-index: 999;
                background: rgba(0, 0, 0, 0.98);
                padding: 60px 15px 15px;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            .game-layout {
                grid-template-columns: 1fr;
            }
            .container {
                padding: 10px;
            }
            .back-btn {
                font-size: 0.8rem;
                padding: 8px 12px;
            }
        }
        /* Settings Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal {
            background: #1a1a2e;
            border-radius: 20px;
            padding: 25px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffc107;
            margin-bottom: 20px;
            text-align: center;
        }
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5rem;
            cursor: pointer;
        }
        .setting-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .setting-label {
            color: #fff;
        }
        .toggle-switch {
            width: 50px;
            height: 26px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 13px;
            cursor: pointer;
            position: relative;
            transition: background 0.3s;
        }
        .toggle-switch.active {
            background: #00ff88;
        }
        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: #fff;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: left 0.3s;
        }
        .toggle-switch.active::after {
            left: 26px;
        }
    </style>
</head>
<body>
    <button id="settingsBtn" class="settings-btn" title="Settings">‚öôÔ∏è</button>
    <button id="soundBtn" class="sound-btn" title="Toggle Sound">üîä</button>
    <button id="fullscreenBtn" class="fullscreen-btn" title="Toggle Fullscreen">‚õ∂</button>
    
    <div class="season-indicator" id="seasonIndicator" style="display: none;">
        <span id="seasonIcon">üéÑ</span>
        <span id="seasonName">Christmas</span>
    </div>
    
    <div class="container">
        <a href="../index.html" class="back-btn">‚Üê Back to Games</a>
        
        <div class="game-container">
            <h1 class="game-title">üç™ Cookie Clicker</h1>
            
            <div class="news-ticker">
                <span class="news-text" id="newsTicker">Welcome to Cookie Clicker! Click the cookie to begin your empire!</span>
            </div>
            
            <div class="clicker-container">
                <div class="game-layout">
                    <div class="main-area">
                        <div class="cookie-count"><span id="cookies">0</span> cookies</div>
                        <div class="per-second">per second: <span id="cps">0</span></div>
                        <div class="multiplier-info" id="multiplierInfo"></div>
                        
                        <div class="sugar-lump-display" id="sugarLumpDisplay" title="Click to harvest when ripe!">
                            <span>üç¨</span>
                            <span id="sugarLumps">0</span> Sugar Lumps
                            <span id="sugarLumpTimer" style="font-size: 0.8rem; color: #888;"></span>
                        </div>
                        
                        <div class="cookie-wrapper" id="cookieWrapper">
                            <div class="cookie-glow"></div>
                            <div class="milk-layer" id="milkLayer"></div>
                            <div class="cookie" id="cookie">üç™</div>
                        </div>
                        
                        <div class="tabs">
                            <button class="tab-btn active" data-tab="buildings">üè≠ Buildings</button>
                            <button class="tab-btn" data-tab="upgrades">‚¨ÜÔ∏è Upgrades</button>
                        </div>
                        
                        <div id="buildingsTab">
                            <div class="buy-amount-toggle">
                                <button class="buy-btn active" data-amount="1">x1</button>
                                <button class="buy-btn" data-amount="10">x10</button>
                                <button class="buy-btn" data-amount="100">x100</button>
                                <button class="buy-btn" data-amount="max">Max</button>
                            </div>
                            <div class="upgrades" id="upgrades"></div>
                        </div>
                        
                        <div id="upgradesTab" style="display: none;">
                            <h4 style="margin-bottom: 10px;">üñ±Ô∏è Click Upgrades</h4>
                            <div class="click-upgrades-section" id="clickUpgrades"></div>
                            
                            <h4 style="margin: 15px 0 10px;">üè≠ Building Upgrades</h4>
                            <div class="building-upgrades-section" id="buildingUpgrades"></div>
                        </div>
                    </div>
                    
                    <div class="side-panel" id="sidePanel">
                        <div class="panel-section">
                            <div class="panel-title" onclick="togglePanel(this)">
                                üìä Statistics
                                <span class="toggle-icon">‚ñº</span>
                            </div>
                            <div class="panel-content">
                                <div class="stats">
                                    <div class="stat-box">
                                        <div class="stat-value" id="totalClicks">0</div>
                                        <div class="stat-label">Total Clicks</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-value" id="clickPower">1</div>
                                        <div class="stat-label">Per Click</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-value" id="totalCookies">0</div>
                                        <div class="stat-label">All Time</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-value" id="goldenClicks">0</div>
                                        <div class="stat-label">Golden Clicks</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-value" id="wrinklersCookies">0</div>
                                        <div class="stat-label">Wrinkler Cookies</div>
                                    </div>
                                    <div class="stat-box">
                                        <div class="stat-value" id="buildingsOwned">0</div>
                                        <div class="stat-label">Buildings</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="panel-section">
                            <div class="panel-title" onclick="togglePanel(this)">
                                üèÜ Achievements <span id="achievementCount">(0/30)</span>
                                <span class="toggle-icon">‚ñº</span>
                            </div>
                            <div class="panel-content">
                                <div class="achievements-grid" id="achievements"></div>
                            </div>
                        </div>
                        
                        <div class="panel-section">
                            <div class="panel-title" onclick="togglePanel(this)">
                                ‚ú® Prestige
                                <span class="toggle-icon">‚ñº</span>
                            </div>
                            <div class="panel-content">
                                <div class="prestige-info">
                                    Heavenly Chips: <span class="heavenly-chips" id="heavenlyChips">0</span><br>
                                    <small>(+<span id="heavenlyBonus">0</span>% CPS bonus)</small>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="prestigeProgress" style="width: 0%"></div>
                                </div>
                                <div class="prestige-info">
                                    Prestige for: <span class="heavenly-chips" id="prestigeGain">0</span> chips
                                </div>
                                <button class="prestige-btn" id="prestigeBtn" disabled>Ascend ‚ú®</button>
                            </div>
                        </div>
                        
                        <div class="panel-section">
                            <div class="buttons-row">
                                <button id="saveBtn" class="btn btn-secondary btn-small">üíæ Save</button>
                                <button id="exportBtn" class="btn btn-secondary btn-small">üì§ Export</button>
                                <button id="importBtn" class="btn btn-secondary btn-small">üì• Import</button>
                                <button id="resetBtn" class="btn btn-secondary btn-small">üóëÔ∏è Reset</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Mobile Navigation -->
    <div class="mobile-nav">
        <div class="mobile-nav-items">
            <div class="mobile-nav-item active" data-view="cookie">
                <span>üç™</span>
                <span>Cookie</span>
            </div>
            <div class="mobile-nav-item" data-view="shop">
                <span>üè™</span>
                <span>Shop</span>
            </div>
            <div class="mobile-nav-item" data-view="stats">
                <span>üìä</span>
                <span>Stats</span>
            </div>
            <div class="mobile-nav-item" data-view="prestige">
                <span>‚ú®</span>
                <span>Prestige</span>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <div class="modal-title">‚öôÔ∏è Settings</div>
            <div class="setting-row">
                <span class="setting-label">Sound Effects</span>
                <div class="toggle-switch active" id="soundToggle"></div>
            </div>
            <div class="setting-row">
                <span class="setting-label">Particle Effects</span>
                <div class="toggle-switch active" id="particlesToggle"></div>
            </div>
            <div class="setting-row">
                <span class="setting-label">Wrinklers Enabled</span>
                <div class="toggle-switch active" id="wrinklersToggle"></div>
            </div>
            <div class="setting-row">
                <span class="setting-label">Short Numbers</span>
                <div class="toggle-switch" id="shortNumbersToggle"></div>
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button class="btn btn-primary" onclick="closeSettings()">Close</button>
            </div>
        </div>
    </div>

    <script>
        // === GAME DATA ===
        const BUILDINGS = [
            { id: 'cursor', name: 'Cursor', icon: 'üëÜ', baseCost: 15, cps: 0.1, desc: 'Auto-clicks' },
            { id: 'grandma', name: 'Grandma', icon: 'üëµ', baseCost: 100, cps: 1, desc: 'Bakes cookies' },
            { id: 'farm', name: 'Farm', icon: 'üåæ', baseCost: 1100, cps: 8, desc: 'Cookie plants' },
            { id: 'mine', name: 'Mine', icon: '‚õèÔ∏è', baseCost: 12000, cps: 47, desc: 'Cookie ore' },
            { id: 'factory', name: 'Factory', icon: 'üè≠', baseCost: 130000, cps: 260, desc: 'Mass production' },
            { id: 'bank', name: 'Bank', icon: 'üè¶', baseCost: 1400000, cps: 1400, desc: 'Cookie interest' },
            { id: 'temple', name: 'Temple', icon: 'üèõÔ∏è', baseCost: 20000000, cps: 7800, desc: 'Cookie prayers' },
            { id: 'wizard', name: 'Wizard', icon: 'üßô', baseCost: 330000000, cps: 44000, desc: 'Magic cookies' },
            { id: 'shipment', name: 'Shipment', icon: 'üöÄ', baseCost: 5100000000, cps: 260000, desc: 'Space cookies' },
            { id: 'alchemy', name: 'Alchemy Lab', icon: '‚öóÔ∏è', baseCost: 75000000000, cps: 1600000, desc: 'Golden cookies' },
            { id: 'portal', name: 'Portal', icon: 'üåÄ', baseCost: 1000000000000, cps: 10000000, desc: 'Cookieverse' },
            { id: 'time', name: 'Time Machine', icon: '‚è∞', baseCost: 14000000000000, cps: 65000000, desc: 'Past cookies' }
        ];

        const CLICK_UPGRADES = [
            { id: 'click1', name: 'Plastic Mouse', icon: 'üñ±Ô∏è', cost: 100, multiplier: 2, desc: '2x click' },
            { id: 'click2', name: 'Iron Mouse', icon: 'üí™', cost: 500, multiplier: 2, desc: '2x click' },
            { id: 'click3', name: 'Titanium Mouse', icon: 'ü¶æ', cost: 5000, multiplier: 2, desc: '2x click' },
            { id: 'click4', name: 'Diamond Mouse', icon: 'üíé', cost: 50000, multiplier: 2, desc: '2x click' },
            { id: 'click5', name: 'Quantum Mouse', icon: '‚öõÔ∏è', cost: 500000, multiplier: 2, desc: '2x click' },
            { id: 'click6', name: 'Cosmic Mouse', icon: 'üåå', cost: 5000000, multiplier: 2, desc: '2x click' }
        ];

        const BUILDING_UPGRADES = [
            { id: 'bu_cursor', building: 'cursor', name: 'Reinforced Index', icon: 'üëÜ', cost: 100, desc: 'Cursors are twice as efficient', requires: 1 },
            { id: 'bu_cursor2', building: 'cursor', name: 'Carpal Tunnel', icon: 'ü§û', cost: 5000, desc: 'Cursors are twice as efficient', requires: 10 },
            { id: 'bu_grandma', building: 'grandma', name: 'Rolling Pins', icon: 'üëµ', cost: 1000, desc: 'Grandmas are twice as efficient', requires: 1 },
            { id: 'bu_grandma2', building: 'grandma', name: 'Secret Recipe', icon: 'üìú', cost: 50000, desc: 'Grandmas are twice as efficient', requires: 10 },
            { id: 'bu_farm', building: 'farm', name: 'Fertilizer', icon: 'üåæ', cost: 11000, desc: 'Farms are twice as efficient', requires: 1 },
            { id: 'bu_farm2', building: 'farm', name: 'Cookie Seeds', icon: 'üå±', cost: 550000, desc: 'Farms are twice as efficient', requires: 10 },
            { id: 'bu_mine', building: 'mine', name: 'Better Drills', icon: '‚õèÔ∏è', cost: 120000, desc: 'Mines are twice as efficient', requires: 1 },
            { id: 'bu_mine2', building: 'mine', name: 'Chocolate Veins', icon: 'üç´', cost: 6000000, desc: 'Mines are twice as efficient', requires: 10 },
            { id: 'bu_factory', building: 'factory', name: 'Assembly Line', icon: 'üè≠', cost: 1300000, desc: 'Factories are twice as efficient', requires: 1 },
            { id: 'bu_factory2', building: 'factory', name: 'Robot Workers', icon: 'ü§ñ', cost: 65000000, desc: 'Factories are twice as efficient', requires: 10 },
            { id: 'bu_bank', building: 'bank', name: 'High Interest', icon: 'üè¶', cost: 14000000, desc: 'Banks are twice as efficient', requires: 1 },
            { id: 'bu_temple', building: 'temple', name: 'Holy Cookies', icon: 'üèõÔ∏è', cost: 200000000, desc: 'Temples are twice as efficient', requires: 1 },
            { id: 'bu_wizard', building: 'wizard', name: 'Spell Mastery', icon: 'üßô', cost: 3300000000, desc: 'Wizards are twice as efficient', requires: 1 },
            { id: 'bu_shipment', building: 'shipment', name: 'Warp Drive', icon: 'üöÄ', cost: 51000000000, desc: 'Shipments are twice as efficient', requires: 1 },
            { id: 'bu_alchemy', building: 'alchemy', name: "Philosopher's Stone", icon: '‚öóÔ∏è', cost: 750000000000, desc: 'Alchemy Labs are twice as efficient', requires: 1 },
            { id: 'bu_portal', building: 'portal', name: 'Dimensional Gate', icon: 'üåÄ', cost: 10000000000000, desc: 'Portals are twice as efficient', requires: 1 },
            { id: 'bu_time', building: 'time', name: 'Flux Capacitor', icon: '‚è∞', cost: 140000000000000, desc: 'Time Machines are twice as efficient', requires: 1 }
        ];

        const ACHIEVEMENTS = [
            { id: 'click1', name: 'First Click', icon: 'üëÜ', condition: () => totalClicks >= 1 },
            { id: 'click100', name: 'Click Master', icon: '‚úåÔ∏è', condition: () => totalClicks >= 100 },
            { id: 'click1000', name: 'Click Lord', icon: 'üñêÔ∏è', condition: () => totalClicks >= 1000 },
            { id: 'click10000', name: 'Click God', icon: 'üëä', condition: () => totalClicks >= 10000 },
            { id: 'click100000', name: 'Click Deity', icon: 'ü´µ', condition: () => totalClicks >= 100000 },
            { id: 'cookie100', name: 'Baker', icon: 'üç™', condition: () => totalCookiesBaked >= 100 },
            { id: 'cookie10000', name: 'Cookie Factory', icon: 'üè≠', condition: () => totalCookiesBaked >= 10000 },
            { id: 'cookie1m', name: 'Cookie Empire', icon: 'üëë', condition: () => totalCookiesBaked >= 1000000 },
            { id: 'cookie1b', name: 'Cookie Billionaire', icon: 'üí∞', condition: () => totalCookiesBaked >= 1000000000 },
            { id: 'cookie1t', name: 'Cookie Trillionaire', icon: 'üíé', condition: () => totalCookiesBaked >= 1000000000000 },
            { id: 'cps10', name: 'Speed Baker', icon: '‚ö°', condition: () => cps >= 10 },
            { id: 'cps100', name: 'Turbo Baker', icon: 'üöÄ', condition: () => cps >= 100 },
            { id: 'cps10000', name: 'Hyperspeed', icon: 'üí´', condition: () => cps >= 10000 },
            { id: 'cps1m', name: 'Light Speed', icon: '‚òÑÔ∏è', condition: () => cps >= 1000000 },
            { id: 'golden1', name: 'Lucky', icon: 'üçÄ', condition: () => goldenClicks >= 1 },
            { id: 'golden10', name: 'Very Lucky', icon: 'üåü', condition: () => goldenClicks >= 10 },
            { id: 'golden50', name: 'Fortune', icon: 'üé∞', condition: () => goldenClicks >= 50 },
            { id: 'build10', name: 'Builder', icon: 'üî®', condition: () => getTotalBuildings() >= 10 },
            { id: 'build50', name: 'Architect', icon: 'üèóÔ∏è', condition: () => getTotalBuildings() >= 50 },
            { id: 'build100', name: 'Industrialist', icon: 'üèõÔ∏è', condition: () => getTotalBuildings() >= 100 },
            { id: 'build200', name: 'Mogul', icon: 'üåÜ', condition: () => getTotalBuildings() >= 200 },
            { id: 'prestige1', name: 'Ascended', icon: '‚ú®', condition: () => heavenlyChips >= 1 },
            { id: 'prestige100', name: 'Enlightened', icon: 'üåÖ', condition: () => heavenlyChips >= 100 },
            { id: 'prestige1000', name: 'Transcendent', icon: 'üåå', condition: () => heavenlyChips >= 1000 },
            { id: 'wrinkler1', name: 'Disgusting', icon: 'üêõ', condition: () => totalWrinklerCookies >= 1000 },
            { id: 'wrinkler1m', name: 'Parasitic', icon: 'ü™±', condition: () => totalWrinklerCookies >= 1000000 },
            { id: 'sugar1', name: 'Sweet Tooth', icon: 'üç¨', condition: () => sugarLumps >= 1 },
            { id: 'sugar10', name: 'Sugar Rush', icon: 'üç≠', condition: () => sugarLumps >= 10 },
            { id: 'season1', name: 'Seasonal', icon: 'üéÑ', condition: () => seasonsUnlocked >= 1 },
            { id: 'allupgrades', name: 'Completionist', icon: 'üèÖ', condition: () => Object.values(purchasedClickUpgrades).every(v => v) && Object.values(purchasedBuildingUpgrades).filter(v => v).length >= 10 }
        ];

        const NEWS_MESSAGES = [
            "Grandmas report record cookie output!",
            "Scientists discover cookies improve happiness by 200%!",
            "Cookie stocks reach all-time high!",
            "Local farm grows giant cookie plant!",
            "Time travelers confirm: cookies exist in all timelines!",
            "Breaking: Wizard successfully conjures infinite cookies!",
            "Cookie mines uncover rare chocolate chip vein!",
            "Space mission returns with extraterrestrial cookies!",
            "Economists: Cookie-based economy most stable ever!",
            "New study: Clicking increases cookie production!",
            "Wrinklers sighted near cookie factory!",
            "Sugar lump harvest season approaches!",
            "Portal researchers discover cookie dimension!",
            "Bank introduces cookie-backed currency!",
            "Alchemy lab turns lead into chocolate chips!"
        ];

        const GOLDEN_EFFECTS = [
            { name: 'Frenzy', desc: 'Cookie production x7 for 77 seconds!', duration: 77000, multiplier: 7 },
            { name: 'Lucky', desc: 'Gained cookies worth 13 seconds of production!', instant: true },
            { name: 'Click Frenzy', desc: 'Clicking power x777 for 13 seconds!', duration: 13000, clickMultiplier: 777 },
            { name: 'Cookie Storm', desc: 'Cookies are raining!', storm: true },
            { name: 'Building Rush', desc: 'All buildings produce x3 for 30 seconds!', duration: 30000, multiplier: 3 },
            { name: 'Sweet Windfall', desc: 'Gained a bonus sugar lump!', sugarBonus: true }
        ];

        const SEASONS = [
            { id: 'christmas', name: 'Christmas', icon: 'üéÑ', months: [11, 0] },
            { id: 'valentines', name: "Valentine's", icon: 'üíù', months: [1] },
            { id: 'easter', name: 'Easter', icon: 'ü•ö', months: [2, 3] },
            { id: 'halloween', name: 'Halloween', icon: 'üéÉ', months: [9] }
        ];

        // === GAME STATE ===
        let cookies = 0;
        let totalClicks = 0;
        let totalCookiesBaked = 0;
        let clickPower = 1;
        let baseClickPower = 1;
        let cps = 0;
        let baseCps = 0;
        let owned = {};
        let buildingLevels = {};
        let purchasedClickUpgrades = {};
        let purchasedBuildingUpgrades = {};
        let unlockedAchievements = {};
        let heavenlyChips = 0;
        let goldenClicks = 0;
        let buyAmount = 1;
        let soundEnabled = true;
        let particlesEnabled = true;
        let wrinklersEnabled = true;
        let shortNumbers = false;

        // Sugar Lumps
        let sugarLumps = 0;
        let sugarLumpGrowStart = Date.now();
        const SUGAR_LUMP_GROW_TIME = 600000; // 10 minutes to ripen

        // Wrinklers
        let wrinklers = [];
        let totalWrinklerCookies = 0;
        const MAX_WRINKLERS = 5;
        const WRINKLER_SPAWN_INTERVAL = 120000; // 2 minutes

        // Seasons
        let currentSeason = null;
        let seasonsUnlocked = 0;
        let seasonCookiesCollected = {};

        // Active effects
        let frenzyMultiplier = 1;
        let clickFrenzyMultiplier = 1;
        let frenzyTimeout = null;
        let clickFrenzyTimeout = null;
        let goldenCookieTimeout = null;

        // Frenzy timers for display
        let frenzyEndTime = 0;
        let clickFrenzyEndTime = 0;

        // Audio context reuse
        let audioCtx = null;

        BUILDINGS.forEach(u => { owned[u.id] = 0; buildingLevels[u.id] = 0; });
        CLICK_UPGRADES.forEach(u => purchasedClickUpgrades[u.id] = false);
        BUILDING_UPGRADES.forEach(u => purchasedBuildingUpgrades[u.id] = false);
        ACHIEVEMENTS.forEach(a => unlockedAchievements[a.id] = false);

        // === DOM ELEMENTS ===
        const cookieEl = document.getElementById('cookie');
        const cookiesEl = document.getElementById('cookies');
        const cpsEl = document.getElementById('cps');
        const upgradesEl = document.getElementById('upgrades');
        const clickUpgradesEl = document.getElementById('clickUpgrades');
        const totalClicksEl = document.getElementById('totalClicks');
        const clickPowerEl = document.getElementById('clickPower');
        const totalCookiesEl = document.getElementById('totalCookies');
        const goldenClicksEl = document.getElementById('goldenClicks');
        const achievementsEl = document.getElementById('achievements');
        const heavenlyChipsEl = document.getElementById('heavenlyChips');
        const heavenlyBonusEl = document.getElementById('heavenlyBonus');
        const prestigeGainEl = document.getElementById('prestigeGain');
        const prestigeProgressEl = document.getElementById('prestigeProgress');
        const prestigeBtn = document.getElementById('prestigeBtn');
        const multiplierInfoEl = document.getElementById('multiplierInfo');
        const newsTickerEl = document.getElementById('newsTicker');
        const milkLayerEl = document.getElementById('milkLayer');
        const sugarLumpsEl = document.getElementById('sugarLumps');
        const sugarLumpTimerEl = document.getElementById('sugarLumpTimer');

        // === HELPER FUNCTIONS ===
        function getTotalBuildings() {
            return Object.values(owned).reduce((a, b) => a + b, 0);
        }

        function formatNumber(n) {
            if (shortNumbers) {
                if (n >= 1e33) return (n / 1e33).toFixed(2) + ' Dc';
                if (n >= 1e30) return (n / 1e30).toFixed(2) + ' No';
                if (n >= 1e27) return (n / 1e27).toFixed(2) + ' Oc';
                if (n >= 1e24) return (n / 1e24).toFixed(2) + ' Sp';
                if (n >= 1e21) return (n / 1e21).toFixed(2) + ' Sx';
                if (n >= 1e18) return (n / 1e18).toFixed(2) + ' Qi';
                if (n >= 1e15) return (n / 1e15).toFixed(2) + ' Qa';
                if (n >= 1e12) return (n / 1e12).toFixed(2) + ' T';
                if (n >= 1e9) return (n / 1e9).toFixed(2) + ' B';
                if (n >= 1e6) return (n / 1e6).toFixed(2) + ' M';
                if (n >= 1e3) return (n / 1e3).toFixed(2) + ' K';
            } else {
                if (n >= 1e33) return (n / 1e33).toFixed(2) + ' decillion';
                if (n >= 1e30) return (n / 1e30).toFixed(2) + ' nonillion';
                if (n >= 1e27) return (n / 1e27).toFixed(2) + ' octillion';
                if (n >= 1e24) return (n / 1e24).toFixed(2) + ' septillion';
                if (n >= 1e21) return (n / 1e21).toFixed(2) + ' sextillion';
                if (n >= 1e18) return (n / 1e18).toFixed(2) + ' quintillion';
                if (n >= 1e15) return (n / 1e15).toFixed(2) + ' quadrillion';
                if (n >= 1e12) return (n / 1e12).toFixed(2) + ' trillion';
                if (n >= 1e9) return (n / 1e9).toFixed(2) + ' billion';
                if (n >= 1e6) return (n / 1e6).toFixed(2) + ' million';
                if (n >= 1e3) return (n / 1e3).toFixed(2) + ' thousand';
            }
            return Math.floor(n).toLocaleString();
        }

        function getCost(building, amount = 1) {
            let total = 0;
            for (let i = 0; i < amount; i++) {
                total += Math.floor(building.baseCost * Math.pow(1.15, owned[building.id] + i));
            }
            return total;
        }

        function getMaxAffordable(building) {
            let count = 0;
            let cost = 0;
            let tempOwned = owned[building.id];
            while (cost + Math.floor(building.baseCost * Math.pow(1.15, tempOwned)) <= cookies) {
                cost += Math.floor(building.baseCost * Math.pow(1.15, tempOwned));
                tempOwned++;
                count++;
                if (count > 1000) break;
            }
            return count;
        }

        function calculatePrestigeGain() {
            return Math.floor(Math.pow(totalCookiesBaked / 1e12, 0.5));
        }

        function getAudioContext() {
            if (!audioCtx || audioCtx.state === 'closed') {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
            return audioCtx;
        }

        function playSound(type) {
            if (!soundEnabled) return;
            try {
                const ctx = getAudioContext();
                const oscillator = ctx.createOscillator();
                const gainNode = ctx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(ctx.destination);

                if (type === 'click') {
                    oscillator.frequency.value = 800;
                    gainNode.gain.value = 0.1;
                    oscillator.start();
                    oscillator.stop(ctx.currentTime + 0.05);
                } else if (type === 'buy') {
                    oscillator.frequency.value = 600;
                    gainNode.gain.value = 0.1;
                    oscillator.start();
                    oscillator.stop(ctx.currentTime + 0.1);
                } else if (type === 'golden') {
                    oscillator.frequency.value = 1200;
                    gainNode.gain.value = 0.15;
                    oscillator.start();
                    setTimeout(() => { try { oscillator.frequency.value = 1400; } catch(e) {} }, 100);
                    oscillator.stop(ctx.currentTime + 0.2);
                } else if (type === 'achievement') {
                    oscillator.type = 'sine';
                    oscillator.frequency.value = 523;
                    gainNode.gain.value = 0.1;
                    oscillator.start();
                    setTimeout(() => { try { oscillator.frequency.value = 659; } catch(e) {} }, 100);
                    setTimeout(() => { try { oscillator.frequency.value = 784; } catch(e) {} }, 200);
                    oscillator.stop(ctx.currentTime + 0.3);
                } else if (type === 'wrinkler') {
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.value = 200;
                    gainNode.gain.value = 0.1;
                    oscillator.start();
                    oscillator.stop(ctx.currentTime + 0.15);
                } else if (type === 'sugar') {
                    oscillator.type = 'sine';
                    oscillator.frequency.value = 1000;
                    gainNode.gain.value = 0.12;
                    oscillator.start();
                    setTimeout(() => { try { oscillator.frequency.value = 1200; } catch(e) {} }, 80);
                    setTimeout(() => { try { oscillator.frequency.value = 1500; } catch(e) {} }, 160);
                    oscillator.stop(ctx.currentTime + 0.25);
                }
            } catch(e) {}
        }

        // === CLICK EFFECTS ===
        function createClickEffect(x, y) {
            if (!particlesEnabled) return;
            const amount = clickPower * clickFrenzyMultiplier;
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.textContent = '+' + formatNumber(amount);
            effect.style.left = (x - 20) + 'px';
            effect.style.top = (y - 10) + 'px';
            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 1000);

            // Create cookie crumbs
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const crumb = document.createElement('div');
                    crumb.className = 'cookie-crumb';
                    crumb.textContent = 'üç™';
                    crumb.style.left = (x + (Math.random() - 0.5) * 60) + 'px';
                    crumb.style.top = y + 'px';
                    crumb.style.fontSize = (0.5 + Math.random() * 0.5) + 'rem';
                    document.body.appendChild(crumb);
                    setTimeout(() => crumb.remove(), 1000);
                }, i * 50);
            }
        }

        // === SUGAR LUMPS ===
        function getSugarLumpProgress() {
            const elapsed = Date.now() - sugarLumpGrowStart;
            return Math.min(1, elapsed / SUGAR_LUMP_GROW_TIME);
        }

        function isSugarLumpRipe() {
            return getSugarLumpProgress() >= 1;
        }

        function harvestSugarLump() {
            if (!isSugarLumpRipe()) return;
            sugarLumps++;
            sugarLumpGrowStart = Date.now();
            playSound('sugar');

            // Show harvest effect
            const display = document.getElementById('sugarLumpDisplay');
            const rect = display.getBoundingClientRect();
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.textContent = '+1 Sugar Lump!';
            effect.style.left = rect.left + 'px';
            effect.style.top = (rect.top - 20) + 'px';
            effect.style.color = '#e91e63';
            document.body.appendChild(effect);
            setTimeout(() => effect.remove(), 1000);

            checkAchievements();
            saveGame();
        }

        function updateSugarLumpDisplay() {
            sugarLumpsEl.textContent = sugarLumps;
            const progress = getSugarLumpProgress();
            const display = document.getElementById('sugarLumpDisplay');

            if (isSugarLumpRipe()) {
                sugarLumpTimerEl.textContent = '(Ripe! Click to harvest!)';
                sugarLumpTimerEl.style.color = '#e91e63';
                display.style.animation = 'cookie-pulse 1s ease-in-out infinite';
                display.style.borderColor = '#e91e63';
            } else {
                const remaining = Math.ceil((SUGAR_LUMP_GROW_TIME - (Date.now() - sugarLumpGrowStart)) / 1000);
                const min = Math.floor(remaining / 60);
                const sec = remaining % 60;
                sugarLumpTimerEl.textContent = `(${min}:${sec.toString().padStart(2, '0')})`;
                sugarLumpTimerEl.style.color = '#888';
                display.style.animation = 'none';
                display.style.borderColor = 'rgba(233, 30, 99, 0.3)';
            }
        }

        function useSugarLump(buildingId) {
            if (sugarLumps < 1) return;
            sugarLumps--;
            buildingLevels[buildingId] = (buildingLevels[buildingId] || 0) + 1;
            playSound('buy');
            recalculateCPS();
            renderBuildings();
            updateDisplay();
            saveGame();
        }

        // === WRINKLERS ===
        function spawnWrinkler() {
            if (!wrinklersEnabled) return;
            if (wrinklers.length >= MAX_WRINKLERS) return;
            if (cps <= 0) return;

            const wrapper = document.getElementById('cookieWrapper');
            const wrapperRect = wrapper.getBoundingClientRect();

            const angle = (wrinklers.length / MAX_WRINKLERS) * Math.PI * 2 + Math.random() * 0.5;
            const radius = 80;

            const wrinklerEl = document.createElement('div');
            wrinklerEl.className = 'wrinkler';
            wrinklerEl.textContent = 'üêõ';
            wrinklerEl.style.position = 'absolute';
            wrinklerEl.style.left = (50 + Math.cos(angle) * radius) + '%';
            wrinklerEl.style.top = (50 + Math.sin(angle) * radius) + '%';
            wrinklerEl.style.transform = 'translate(-50%, -50%)';

            const wrinklerData = {
                el: wrinklerEl,
                cookiesSucked: 0,
                spawnTime: Date.now()
            };

            wrinklerEl.addEventListener('click', (e) => {
                e.stopPropagation();
                popWrinkler(wrinklerData);
            });

            wrapper.appendChild(wrinklerEl);
            wrinklers.push(wrinklerData);
        }

        function popWrinkler(wrinklerData) {
            const returnAmount = wrinklerData.cookiesSucked * 1.1;
            cookies += returnAmount;
            totalCookiesBaked += returnAmount;
            totalWrinklerCookies += returnAmount;

            playSound('wrinkler');

            // Pop effect
            const rect = wrinklerData.el.getBoundingClientRect();
            const popup = document.createElement('div');
            popup.className = 'wrinkler-pop';
            popup.textContent = '+' + formatNumber(returnAmount);
            popup.style.left = rect.left + 'px';
            popup.style.top = rect.top + 'px';
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 1500);

            wrinklerData.el.remove();
            wrinklers = wrinklers.filter(w => w !== wrinklerData);

            checkAchievements();
            updateDisplay();
            saveGame();
        }

        function updateWrinklers() {
            if (!wrinklersEnabled || cps <= 0) return;
            const suckRate = (cps * frenzyMultiplier) / 20;
            wrinklers.forEach(w => {
                w.cookiesSucked += suckRate / 10;
            });
        }

        function getWrinklerDrain() {
            if (!wrinklersEnabled) return 0;
            return wrinklers.length * 0.05;
        }

        // === SEASONS ===
        function detectSeason() {
            const month = new Date().getMonth();
            const season = SEASONS.find(s => s.months.includes(month));
            if (season && season.id !== (currentSeason && currentSeason.id)) {
                currentSeason = season;
                seasonsUnlocked++;
                updateSeasonDisplay();
                checkAchievements();
            } else if (!season) {
                currentSeason = null;
                updateSeasonDisplay();
            }
        }

        function updateSeasonDisplay() {
            const indicator = document.getElementById('seasonIndicator');
            if (currentSeason) {
                indicator.style.display = 'flex';
                document.getElementById('seasonIcon').textContent = currentSeason.icon;
                document.getElementById('seasonName').textContent = currentSeason.name;
            } else {
                indicator.style.display = 'none';
            }
        }

        function getSeasonMultiplier() {
            if (!currentSeason) return 1;
            return 1.05;
        }

        // === GOLDEN COOKIE ===
        function spawnGoldenCookie() {
            if (document.querySelector('.golden-cookie')) return;

            const golden = document.createElement('div');
            golden.className = 'golden-cookie';
            golden.textContent = 'üåü';
            golden.style.left = (100 + Math.random() * (window.innerWidth - 200)) + 'px';
            golden.style.top = (100 + Math.random() * (window.innerHeight - 200)) + 'px';

            golden.addEventListener('click', () => {
                goldenClicks++;
                playSound('golden');
                triggerGoldenEffect();
                golden.remove();
            });

            document.body.appendChild(golden);

            // Auto-remove after 13 seconds
            setTimeout(() => golden.remove(), 13000);
        }

        function triggerGoldenEffect() {
            const effect = GOLDEN_EFFECTS[Math.floor(Math.random() * GOLDEN_EFFECTS.length)];

            // Show effect announcement
            const announce = document.createElement('div');
            announce.className = 'golden-effect';
            announce.innerHTML = `<div style="font-size: 3rem">üåü</div>${effect.name}<br><small>${effect.desc}</small>`;
            document.body.appendChild(announce);
            setTimeout(() => announce.remove(), 2000);

            if (effect.multiplier) {
                clearTimeout(frenzyTimeout);
                frenzyMultiplier = effect.multiplier;
                frenzyEndTime = Date.now() + effect.duration;
                document.body.classList.add('frenzy-active');
                frenzyTimeout = setTimeout(() => {
                    frenzyMultiplier = 1;
                    frenzyEndTime = 0;
                    document.body.classList.remove('frenzy-active');
                    updateDisplay();
                }, effect.duration);
            }

            if (effect.clickMultiplier) {
                clearTimeout(clickFrenzyTimeout);
                clickFrenzyMultiplier = effect.clickMultiplier;
                clickFrenzyEndTime = Date.now() + effect.duration;
                clickFrenzyTimeout = setTimeout(() => {
                    clickFrenzyMultiplier = 1;
                    clickFrenzyEndTime = 0;
                    updateDisplay();
                }, effect.duration);
            }

            if (effect.instant) {
                const bonus = Math.max(cps * 13, cookies * 0.15);
                cookies += bonus;
                totalCookiesBaked += bonus;
            }

            if (effect.sugarBonus) {
                sugarLumps++;
            }

            if (effect.storm) {
                // Cookie storm - spawn clickable cookies
                for (let i = 0; i < 20; i++) {
                    setTimeout(() => {
                        const stormCookie = document.createElement('div');
                        stormCookie.className = 'golden-cookie';
                        stormCookie.textContent = 'üç™';
                        stormCookie.style.left = Math.random() * window.innerWidth + 'px';
                        stormCookie.style.top = '-50px';
                        stormCookie.style.animation = 'none';
                        stormCookie.style.transition = 'top 2s linear';
                        setTimeout(() => stormCookie.style.top = window.innerHeight + 'px', 50);
                        stormCookie.addEventListener('click', () => {
                            const bonus = cps + clickPower * 10;
                            cookies += bonus;
                            totalCookiesBaked += bonus;
                            stormCookie.remove();
                        });
                        document.body.appendChild(stormCookie);
                        setTimeout(() => stormCookie.remove(), 3000);
                    }, i * 200);
                }
            }

            updateDisplay();
            saveGame();
        }

        function scheduleGoldenCookie() {
            const delay = 60000 + Math.random() * 120000; // 1-3 minutes
            goldenCookieTimeout = setTimeout(() => {
                spawnGoldenCookie();
                scheduleGoldenCookie();
            }, delay);
        }

        // === ACHIEVEMENTS ===
        function checkAchievements() {
            ACHIEVEMENTS.forEach(achievement => {
                if (!unlockedAchievements[achievement.id] && achievement.condition()) {
                    unlockAchievement(achievement);
                }
            });
        }

        function unlockAchievement(achievement) {
            unlockedAchievements[achievement.id] = true;
            playSound('achievement');

            // Show popup
            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `üèÜ Achievement Unlocked!<br><span style="font-size: 1.5rem">${achievement.icon}</span> ${achievement.name}`;
            document.body.appendChild(popup);
            setTimeout(() => popup.remove(), 3000);

            updateMilkLayer();
            renderAchievements();
            saveGame();
        }

        function renderAchievements() {
            achievementsEl.innerHTML = '';
            const unlocked = Object.values(unlockedAchievements).filter(v => v).length;
            document.getElementById('achievementCount').textContent = `(${unlocked}/${ACHIEVEMENTS.length})`;

            ACHIEVEMENTS.forEach(a => {
                const div = document.createElement('div');
                div.className = 'achievement' + (unlockedAchievements[a.id] ? ' unlocked' : '');
                div.textContent = a.icon;
                div.setAttribute('data-name', a.name);
                achievementsEl.appendChild(div);
            });
        }

        // === MILK LAYER ===
        function updateMilkLayer() {
            const unlocked = Object.values(unlockedAchievements).filter(v => v).length;
            const milkPercent = Math.min(50, (unlocked / ACHIEVEMENTS.length) * 60);
            milkLayerEl.style.height = milkPercent + '%';

            // Change milk color based on achievement count
            if (unlocked >= 20) {
                milkLayerEl.style.background = 'linear-gradient(to top, rgba(255, 182, 193, 0.4), transparent)';
            } else if (unlocked >= 10) {
                milkLayerEl.style.background = 'linear-gradient(to top, rgba(200, 230, 255, 0.4), transparent)';
            } else {
                milkLayerEl.style.background = 'linear-gradient(to top, rgba(255, 255, 255, 0.3), transparent)';
            }
        }

        function getMilkMultiplier() {
            const unlocked = Object.values(unlockedAchievements).filter(v => v).length;
            return 1 + (unlocked * 0.01);
        }

        // === UPGRADES & BUILDINGS ===
        function renderClickUpgrades() {
            clickUpgradesEl.innerHTML = '';
            CLICK_UPGRADES.forEach(u => {
                const div = document.createElement('div');
                const isPurchased = purchasedClickUpgrades[u.id];
                const canAfford = cookies >= u.cost;
                div.className = 'click-upgrade' +
                    (isPurchased ? ' purchased' : '') +
                    (!canAfford && !isPurchased ? ' locked' : '');
                div.innerHTML = `
                    <div style="font-size: 1.5rem">${u.icon}</div>
                    <div style="font-size: 0.8rem; font-weight: bold">${u.name}</div>
                    <div style="font-size: 0.7rem; color: ${isPurchased ? '#00ff88' : '#ffc107'}">${isPurchased ? '‚úì Owned' : 'üç™ ' + formatNumber(u.cost)}</div>
                `;
                if (!isPurchased) {
                    div.addEventListener('click', () => buyClickUpgrade(u));
                }
                clickUpgradesEl.appendChild(div);
            });
        }

        function renderBuildingUpgrades() {
            const el = document.getElementById('buildingUpgrades');
            el.innerHTML = '';
            BUILDING_UPGRADES.forEach(bu => {
                const isPurchased = purchasedBuildingUpgrades[bu.id];
                const canAfford = cookies >= bu.cost;
                const hasRequired = owned[bu.building] >= bu.requires;
                const isVisible = hasRequired || isPurchased;
                if (!isVisible) return;

                const div = document.createElement('div');
                div.className = 'building-upgrade' +
                    (isPurchased ? ' purchased' : '') +
                    (!canAfford && !isPurchased ? ' locked' : '');
                div.textContent = bu.icon;
                div.setAttribute('data-tooltip', `${bu.name} (${formatNumber(bu.cost)})\n${bu.desc}`);
                if (!isPurchased && canAfford) {
                    div.addEventListener('click', () => buyBuildingUpgrade(bu));
                }
                el.appendChild(div);
            });
        }

        function buyBuildingUpgrade(upgrade) {
            if (cookies >= upgrade.cost && !purchasedBuildingUpgrades[upgrade.id]) {
                cookies -= upgrade.cost;
                purchasedBuildingUpgrades[upgrade.id] = true;
                playSound('buy');
                recalculateCPS();
                renderBuildingUpgrades();
                renderBuildings();
                updateDisplay();
                saveGame();
            }
        }

        function renderBuildings() {
            upgradesEl.innerHTML = '';

            BUILDINGS.forEach(b => {
                const amount = buyAmount === 'max' ? getMaxAffordable(b) : buyAmount;
                const cost = getCost(b, amount || 1);
                const canAfford = cookies >= cost && amount > 0;

                let bMultiplier = 1;
                BUILDING_UPGRADES.forEach(bu => {
                    if (bu.building === b.id && purchasedBuildingUpgrades[bu.id]) bMultiplier *= 2;
                });
                const level = buildingLevels[b.id] || 0;
                bMultiplier *= (1 + level * 0.1);
                const production = b.cps * owned[b.id] * bMultiplier * frenzyMultiplier * (1 + heavenlyChips * 0.01) * getMilkMultiplier() * getSeasonMultiplier();

                const div = document.createElement('div');
                div.className = 'upgrade' + (!canAfford ? ' locked' : ' affordable');

                const levelStr = level > 0 ? ` <span style="color: #e91e63; font-size: 0.7rem;">Lv.${level}</span>` : '';
                const sugarBtn = sugarLumps > 0 ?
                    `<div class="sugar-level-btn" data-building="${b.id}" title="Use 1 Sugar Lump to level up (+10% production)">üç¨+</div>` : '';

                div.innerHTML = `
                    <div class="upgrade-icon">${b.icon}</div>
                    <div class="upgrade-info">
                        <div class="upgrade-name">${b.name}${levelStr}</div>
                        <div class="upgrade-cost">üç™ ${formatNumber(cost)} ${amount > 1 ? `(x${amount})` : ''}</div>
                        <div class="upgrade-desc">${b.desc} (+${formatNumber(b.cps * bMultiplier)}/s each)</div>
                    </div>
                    <div class="upgrade-right">
                        <div class="upgrade-owned">${owned[b.id]}${sugarBtn}</div>
                        <div class="upgrade-production">${formatNumber(production)}/s</div>
                    </div>
                `;
                div.addEventListener('click', (e) => {
                    if (e.target.classList.contains('sugar-level-btn')) {
                        e.stopPropagation();
                        useSugarLump(e.target.dataset.building);
                        return;
                    }
                    buyBuilding(b, amount || 1);
                });
                upgradesEl.appendChild(div);
            });
        }

        function buyBuilding(building, amount = 1) {
            const cost = getCost(building, amount);
            if (cookies >= cost) {
                cookies -= cost;
                owned[building.id] += amount;
                playSound('buy');
                recalculateCPS();
                renderBuildings();
                renderBuildingUpgrades();
                updateDisplay();
                checkAchievements();
                saveGame();
            }
        }

        function buyClickUpgrade(upgrade) {
            if (cookies >= upgrade.cost && !purchasedClickUpgrades[upgrade.id]) {
                cookies -= upgrade.cost;
                purchasedClickUpgrades[upgrade.id] = true;
                baseClickPower *= upgrade.multiplier;
                clickPower = baseClickPower;
                playSound('buy');
                renderClickUpgrades();
                updateDisplay();
                checkAchievements();
                saveGame();
            }
        }

        function recalculateCPS() {
            baseCps = 0;
            BUILDINGS.forEach(b => {
                let multiplier = 1;
                BUILDING_UPGRADES.forEach(bu => {
                    if (bu.building === b.id && purchasedBuildingUpgrades[bu.id]) {
                        multiplier *= 2;
                    }
                });
                const level = buildingLevels[b.id] || 0;
                multiplier *= (1 + level * 0.1);
                baseCps += b.cps * owned[b.id] * multiplier;
            });
            // Apply heavenly chip bonus + milk + season
            cps = baseCps * (1 + heavenlyChips * 0.01) * getMilkMultiplier() * getSeasonMultiplier();
        }

        // === PRESTIGE ===
        function prestige() {
            const gain = calculatePrestigeGain();
            if (gain < 1) return;

            if (confirm(`Ascend and gain ${formatNumber(gain)} heavenly chips?\nThis will reset your cookies and buildings but you keep achievements, sugar lumps, and gain permanent bonuses!`)) {
                heavenlyChips += gain;

                // Reset progress
                cookies = 0;
                totalCookiesBaked = 0;
                totalClicks = 0;
                baseClickPower = 1;
                clickPower = 1;
                BUILDINGS.forEach(b => { owned[b.id] = 0; buildingLevels[b.id] = 0; });
                CLICK_UPGRADES.forEach(u => purchasedClickUpgrades[u.id] = false);
                BUILDING_UPGRADES.forEach(u => purchasedBuildingUpgrades[u.id] = false);
                frenzyMultiplier = 1;
                clickFrenzyMultiplier = 1;
                frenzyEndTime = 0;
                clickFrenzyEndTime = 0;

                // Remove wrinklers
                wrinklers.forEach(w => w.el.remove());
                wrinklers = [];

                recalculateCPS();
                renderBuildings();
                renderClickUpgrades();
                renderBuildingUpgrades();
                updateDisplay();
                checkAchievements();
                saveGame();
            }
        }

        // === DISPLAY ===
        function updateDisplay() {
            const wrinklerDrain = getWrinklerDrain();
            const effectiveCps = cps * frenzyMultiplier * (1 - wrinklerDrain);
            cookiesEl.textContent = formatNumber(Math.floor(cookies));
            cpsEl.textContent = formatNumber(effectiveCps.toFixed(1));
            totalClicksEl.textContent = formatNumber(totalClicks);
            clickPowerEl.textContent = formatNumber(clickPower * clickFrenzyMultiplier);
            totalCookiesEl.textContent = formatNumber(totalCookiesBaked);
            goldenClicksEl.textContent = formatNumber(goldenClicks);
            heavenlyChipsEl.textContent = formatNumber(heavenlyChips);
            heavenlyBonusEl.textContent = heavenlyChips;

            // Update extra stats
            const buildingsOwnedEl = document.getElementById('buildingsOwned');
            if (buildingsOwnedEl) buildingsOwnedEl.textContent = getTotalBuildings();
            const wrinklersCookiesEl = document.getElementById('wrinklersCookies');
            if (wrinklersCookiesEl) wrinklersCookiesEl.textContent = formatNumber(Math.floor(totalWrinklerCookies));

            const prestigeGain = calculatePrestigeGain();
            prestigeGainEl.textContent = formatNumber(prestigeGain);
            prestigeBtn.disabled = prestigeGain < 1;

            // Progress to next prestige level
            const currentLevel = Math.floor(Math.pow(totalCookiesBaked / 1e12, 0.5));
            const nextLevel = currentLevel + 1;
            const currentThreshold = Math.pow(currentLevel, 2) * 1e12;
            const nextThreshold = Math.pow(nextLevel, 2) * 1e12;
            const progress = ((totalCookiesBaked - currentThreshold) / (nextThreshold - currentThreshold)) * 100;
            prestigeProgressEl.style.width = Math.min(100, Math.max(0, progress)) + '%';

            // Multiplier info with timers
            let multiplierText = '';
            if (frenzyMultiplier > 1) {
                const remaining = Math.max(0, Math.ceil((frenzyEndTime - Date.now()) / 1000));
                multiplierText += `üî• Frenzy x${frenzyMultiplier} (${remaining}s) `;
            }
            if (clickFrenzyMultiplier > 1) {
                const remaining = Math.max(0, Math.ceil((clickFrenzyEndTime - Date.now()) / 1000));
                multiplierText += `‚ö° Click x${clickFrenzyMultiplier} (${remaining}s)`;
            }
            if (wrinklers.length > 0) {
                multiplierText += ` üêõ ${wrinklers.length} Wrinkler${wrinklers.length > 1 ? 's' : ''}`;
            }
            multiplierInfoEl.textContent = multiplierText;

            // Update sugar lumps
            updateSugarLumpDisplay();

            // Update building affordability
            document.querySelectorAll('.upgrade').forEach((el, i) => {
                if (BUILDINGS[i]) {
                    const amount = buyAmount === 'max' ? getMaxAffordable(BUILDINGS[i]) : buyAmount;
                    const cost = getCost(BUILDINGS[i], amount || 1);
                    if (cookies >= cost && amount > 0) {
                        el.classList.remove('locked');
                        el.classList.add('affordable');
                    } else {
                        el.classList.add('locked');
                        el.classList.remove('affordable');
                    }
                }
            });

            // Update click upgrade affordability
            document.querySelectorAll('.click-upgrade').forEach((el, i) => {
                if (CLICK_UPGRADES[i] && !purchasedClickUpgrades[CLICK_UPGRADES[i].id]) {
                    if (cookies >= CLICK_UPGRADES[i].cost) {
                        el.classList.remove('locked');
                    } else {
                        el.classList.add('locked');
                    }
                }
            });
        }

        // === SAVE/LOAD ===
        function saveGame() {
            const save = {
                cookies, totalClicks, totalCookiesBaked, baseClickPower, clickPower,
                owned, buildingLevels, purchasedClickUpgrades, purchasedBuildingUpgrades,
                unlockedAchievements, heavenlyChips, goldenClicks,
                sugarLumps, sugarLumpGrowStart, totalWrinklerCookies, seasonsUnlocked,
                soundEnabled, particlesEnabled, wrinklersEnabled, shortNumbers,
                lastSave: Date.now()
            };
            localStorage.setItem('cookieClicker2', JSON.stringify(save));
        }

        function loadGame() {
            const save = localStorage.getItem('cookieClicker2');
            if (save) {
                const data = JSON.parse(save);
                cookies = data.cookies || 0;
                totalClicks = data.totalClicks || 0;
                totalCookiesBaked = data.totalCookiesBaked || 0;
                baseClickPower = data.baseClickPower || 1;
                clickPower = data.clickPower || 1;
                owned = data.owned || {};
                buildingLevels = data.buildingLevels || {};
                purchasedClickUpgrades = data.purchasedClickUpgrades || {};
                purchasedBuildingUpgrades = data.purchasedBuildingUpgrades || {};
                unlockedAchievements = data.unlockedAchievements || {};
                heavenlyChips = data.heavenlyChips || 0;
                goldenClicks = data.goldenClicks || 0;
                sugarLumps = data.sugarLumps || 0;
                sugarLumpGrowStart = data.sugarLumpGrowStart || Date.now();
                totalWrinklerCookies = data.totalWrinklerCookies || 0;
                seasonsUnlocked = data.seasonsUnlocked || 0;

                // Load settings
                if (data.soundEnabled !== undefined) soundEnabled = data.soundEnabled;
                if (data.particlesEnabled !== undefined) particlesEnabled = data.particlesEnabled;
                if (data.wrinklersEnabled !== undefined) wrinklersEnabled = data.wrinklersEnabled;
                if (data.shortNumbers !== undefined) shortNumbers = data.shortNumbers;

                BUILDINGS.forEach(b => {
                    if (owned[b.id] === undefined) owned[b.id] = 0;
                    if (buildingLevels[b.id] === undefined) buildingLevels[b.id] = 0;
                });
                CLICK_UPGRADES.forEach(u => { if (purchasedClickUpgrades[u.id] === undefined) purchasedClickUpgrades[u.id] = false; });
                BUILDING_UPGRADES.forEach(u => { if (purchasedBuildingUpgrades[u.id] === undefined) purchasedBuildingUpgrades[u.id] = false; });
                ACHIEVEMENTS.forEach(a => { if (unlockedAchievements[a.id] === undefined) unlockedAchievements[a.id] = false; });

                recalculateCPS();

                // Offline progress
                if (data.lastSave) {
                    const elapsed = (Date.now() - data.lastSave) / 1000;
                    const offlineGain = cps * elapsed * 0.5; // 50% efficiency offline
                    if (offlineGain > 0 && elapsed > 60) {
                        cookies += offlineGain;
                        totalCookiesBaked += offlineGain;

                        // Show offline progress popup
                        setTimeout(() => {
                            const timeStr = elapsed >= 3600 ?
                                `${Math.floor(elapsed/3600)}h ${Math.floor((elapsed%3600)/60)}m` :
                                `${Math.floor(elapsed/60)}m`;
                            const popup = document.createElement('div');
                            popup.className = 'golden-effect';
                            popup.innerHTML = `<div style="font-size: 2rem">üåô</div>Welcome back!<br><small>You earned ${formatNumber(offlineGain)} cookies while away (${timeStr})</small>`;
                            document.body.appendChild(popup);
                            setTimeout(() => popup.remove(), 3000);
                        }, 500);
                    }
                }
            }
        }

        function resetGame() {
            if (confirm('Are you sure you want to reset ALL progress including prestige?')) {
                localStorage.removeItem('cookieClicker2');
                location.reload();
            }
        }

        // === NEWS TICKER ===
        function updateNews() {
            // Add contextual news based on game state
            const contextNews = [...NEWS_MESSAGES];
            if (wrinklers.length > 0) contextNews.push(`${wrinklers.length} wrinkler${wrinklers.length > 1 ? 's' : ''} spotted near your cookie!`);
            if (sugarLumps > 5) contextNews.push("Sugar lump surplus reported in the cookie district!");
            if (heavenlyChips > 0) contextNews.push(`Your ${formatNumber(heavenlyChips)} heavenly chips shine bright!`);
            if (currentSeason) contextNews.push(`Happy ${currentSeason.name}! Enjoy the ${Math.round((getSeasonMultiplier()-1)*100)}% seasonal bonus!`);
            if (getTotalBuildings() > 100) contextNews.push("Your cookie empire spans the known universe!");
            newsTickerEl.textContent = contextNews[Math.floor(Math.random() * contextNews.length)];
        }

        // === UI HELPERS ===
        function togglePanel(titleEl) {
            titleEl.parentElement.classList.toggle('collapsed');
        }

        function openSettings() {
            // Sync toggle states
            document.getElementById('soundToggle').classList.toggle('active', soundEnabled);
            document.getElementById('particlesToggle').classList.toggle('active', particlesEnabled);
            document.getElementById('wrinklersToggle').classList.toggle('active', wrinklersEnabled);
            document.getElementById('shortNumbersToggle').classList.toggle('active', shortNumbers);
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
            saveGame();
        }

        // === BACKGROUND PARTICLES ===
        function spawnBackgroundParticle() {
            if (!particlesEnabled) return;
            const particle = document.createElement('div');
            particle.style.cssText = `
                position: fixed;
                pointer-events: none;
                font-size: ${0.5 + Math.random() * 1}rem;
                opacity: 0.15;
                z-index: 0;
                left: ${Math.random() * 100}vw;
                top: 100vh;
                animation: bg-float ${8 + Math.random() * 12}s linear forwards;
            `;
            particle.textContent = ['üç™', '‚ú®', '‚≠ê'][Math.floor(Math.random() * 3)];
            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), 20000);
        }

        // === GAME LOOP ===
        function tick() {
            const wrinklerDrain = getWrinklerDrain();
            const gain = (cps * frenzyMultiplier * (1 - wrinklerDrain)) / 10;
            cookies += gain;
            totalCookiesBaked += gain;
            updateWrinklers();
            updateDisplay();
        }

        // === INITIALIZATION ===
        function init() {
            loadGame();

            // Add background particle animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes bg-float {
                    0% { transform: translateY(0) rotate(0deg); opacity: 0.15; }
                    100% { transform: translateY(-120vh) rotate(360deg); opacity: 0; }
                }
                .sugar-level-btn {
                    display: inline-block;
                    font-size: 0.7rem;
                    background: rgba(233, 30, 99, 0.2);
                    border: 1px solid rgba(233, 30, 99, 0.4);
                    border-radius: 5px;
                    padding: 2px 5px;
                    cursor: pointer;
                    margin-left: 5px;
                    vertical-align: middle;
                    transition: all 0.2s;
                }
                .sugar-level-btn:hover {
                    background: rgba(233, 30, 99, 0.4);
                    transform: scale(1.1);
                }
            `;
            document.head.appendChild(style);

            // Cookie click
            cookieEl.addEventListener('click', (e) => {
                const gain = clickPower * clickFrenzyMultiplier;
                cookies += gain;
                totalCookiesBaked += gain;
                totalClicks++;
                playSound('click');
                createClickEffect(e.clientX, e.clientY);
                updateDisplay();
                checkAchievements();
            });

            // Sugar lump click
            document.getElementById('sugarLumpDisplay').addEventListener('click', harvestSugarLump);

            // Buy amount toggle
            document.querySelectorAll('.buy-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.buy-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    buyAmount = btn.dataset.amount === 'max' ? 'max' : parseInt(btn.dataset.amount);
                    renderBuildings();
                });
            });

            // Buttons
            document.getElementById('resetBtn').addEventListener('click', resetGame);
            document.getElementById('saveBtn').addEventListener('click', () => {
                saveGame();
                const btn = document.getElementById('saveBtn');
                btn.textContent = '‚úì Saved!';
                setTimeout(() => btn.textContent = 'üíæ Save', 1500);
            });
            document.getElementById('fullscreenBtn').addEventListener('click', () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            });
            document.getElementById('soundBtn').addEventListener('click', () => {
                soundEnabled = !soundEnabled;
                document.getElementById('soundBtn').textContent = soundEnabled ? 'üîä' : 'üîá';
                saveGame();
            });
            prestigeBtn.addEventListener('click', prestige);

            // Settings button
            document.getElementById('settingsBtn').addEventListener('click', openSettings);

            // Export / Import
            document.getElementById('exportBtn').addEventListener('click', () => {
                const save = localStorage.getItem('cookieClicker2');
                if (save) {
                    navigator.clipboard.writeText(btoa(save)).then(() => {
                        const btn = document.getElementById('exportBtn');
                        btn.textContent = '‚úì Copied!';
                        setTimeout(() => btn.textContent = 'üì§ Export', 1500);
                    });
                }
            });
            document.getElementById('importBtn').addEventListener('click', () => {
                const input = prompt('Paste your save string:');
                if (input) {
                    try {
                        const data = atob(input);
                        JSON.parse(data); // validate
                        localStorage.setItem('cookieClicker2', data);
                        location.reload();
                    } catch (e) {
                        alert('Invalid save string!');
                    }
                }
            });

            // Settings toggles (functional)
            document.getElementById('soundToggle').addEventListener('click', function() {
                this.classList.toggle('active');
                soundEnabled = this.classList.contains('active');
                document.getElementById('soundBtn').textContent = soundEnabled ? 'üîä' : 'üîá';
            });
            document.getElementById('particlesToggle').addEventListener('click', function() {
                this.classList.toggle('active');
                particlesEnabled = this.classList.contains('active');
            });
            document.getElementById('wrinklersToggle').addEventListener('click', function() {
                this.classList.toggle('active');
                wrinklersEnabled = this.classList.contains('active');
                if (!wrinklersEnabled) {
                    // Pop all wrinklers when disabled
                    [...wrinklers].forEach(w => popWrinkler(w));
                }
            });
            document.getElementById('shortNumbersToggle').addEventListener('click', function() {
                this.classList.toggle('active');
                shortNumbers = this.classList.contains('active');
                renderBuildings();
                updateDisplay();
            });

            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    const tab = btn.dataset.tab;
                    document.getElementById('buildingsTab').style.display = tab === 'buildings' ? '' : 'none';
                    document.getElementById('upgradesTab').style.display = tab === 'upgrades' ? '' : 'none';
                });
            });

            // Mobile navigation
            document.querySelectorAll('.mobile-nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.mobile-nav-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    const view = item.dataset.view;
                    const mainArea = document.querySelector('.main-area');
                    const sidePanel = document.getElementById('sidePanel');
                    if (view === 'cookie') {
                        mainArea.style.display = '';
                        sidePanel.classList.remove('mobile-visible');
                    } else if (view === 'shop') {
                        mainArea.style.display = '';
                        sidePanel.classList.remove('mobile-visible');
                        document.querySelector('.tab-btn[data-tab="buildings"]').click();
                    } else if (view === 'stats' || view === 'prestige') {
                        sidePanel.classList.add('mobile-visible');
                    }
                });
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.target.tagName === 'INPUT') return;
                if (e.key === 's' || e.key === 'S') { saveGame(); }
                if (e.key === '1') document.querySelector('.buy-btn[data-amount="1"]')?.click();
                if (e.key === '2') document.querySelector('.buy-btn[data-amount="10"]')?.click();
                if (e.key === '3') document.querySelector('.buy-btn[data-amount="100"]')?.click();
                if (e.key === '4') document.querySelector('.buy-btn[data-amount="max"]')?.click();
            });

            // Detect season
            detectSeason();

            // Initial render
            renderBuildings();
            renderClickUpgrades();
            renderBuildingUpgrades();
            renderAchievements();
            updateMilkLayer();
            updateDisplay();

            // Sync settings UI
            document.getElementById('soundBtn').textContent = soundEnabled ? 'üîä' : 'üîá';

            // Game loops
            setInterval(tick, 100);
            setInterval(saveGame, 30000);
            setInterval(updateNews, 15000);
            setInterval(checkAchievements, 1000);
            setInterval(() => spawnBackgroundParticle(), 3000);

            // Wrinkler spawning
            setInterval(() => {
                if (wrinklersEnabled && Math.random() < 0.3) {
                    spawnWrinkler();
                }
            }, WRINKLER_SPAWN_INTERVAL);

            // Season check
            setInterval(detectSeason, 60000);

            // Golden cookies
            scheduleGoldenCookie();

            // Spawn first golden cookie after 30 seconds
            setTimeout(spawnGoldenCookie, 30000);

            // Spawn first wrinkler after 2 minutes
            setTimeout(() => { if (wrinklersEnabled) spawnWrinkler(); }, WRINKLER_SPAWN_INTERVAL);
        }

        init();
    </script>
    <script src="../js/game-utils.js"></script>
    <script src="../js/accounts.js"></script>
</body>
</html>
