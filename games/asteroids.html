<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asteroids - Game Hub</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .game-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        canvas {
            border: 2px solid #333;
            border-radius: 5px;
            background: #000;
        }
        .stats-bar {
            display: flex;
            gap: 30px;
        }
        .stat-box {
            text-align: center;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
        }
        .stat-value.score { color: #00ff88; }
        .stat-value.lives { color: #ff6b6b; }
        .stat-label {
            font-size: 0.8rem;
            color: #888;
        }
        .controls-hint {
            color: #888;
            font-size: 0.9rem;
        }
        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <button id="fullscreenBtn" class="fullscreen-btn" title="Toggle Fullscreen">‚õ∂</button>
    <div class="container">
        <a href="../index.html" class="back-btn">‚Üê Back to Games</a>
        
        <div class="game-container">
            <h1 class="game-title">üöÄ Asteroids</h1>
            
            <div class="game-area">
                <div class="stats-bar">
                    <div class="stat-box">
                        <div class="stat-value score" id="score">0</div>
                        <div class="stat-label">Score</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value lives" id="lives">3</div>
                        <div class="stat-label">Lives</div>
                    </div>
                </div>
                
                <canvas id="gameCanvas" width="900" height="700"></canvas>
                
                <p class="controls-hint">Arrow keys to move, SPACE to shoot</p>
                
                <button id="startBtn" class="btn btn-primary">Start Game</button>
            </div>
            
            <div class="instructions">
                <h3>How to Play</h3>
                <p>Destroy all asteroids! Watch out - they break into smaller pieces. Don't crash!</p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let ship = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            angle: -Math.PI / 2,
            velocityX: 0,
            velocityY: 0,
            radius: 15
        };
        
        let asteroids = [];
        let bullets = [];
        let score = 0;
        let lives = 3;
        let gameRunning = false;
        let keys = {};

        function init() {
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);
            
            document.addEventListener('keydown', e => {
                keys[e.code] = true;
                if (e.code === 'Space') e.preventDefault();
            });
            document.addEventListener('keyup', e => keys[e.code] = false);
            
            drawStartScreen();
        }

        function startGame() {
            ship = {
                x: canvas.width / 2,
                y: canvas.height / 2,
                angle: -Math.PI / 2,
                velocityX: 0,
                velocityY: 0,
                radius: 15,
                invincible: 60
            };
            
            asteroids = [];
            bullets = [];
            score = 0;
            lives = 3;
            gameRunning = true;
            
            document.getElementById('startBtn').textContent = 'Playing...';
            document.getElementById('startBtn').disabled = true;
            
            spawnAsteroids(4);
            updateDisplay();
            gameLoop();
        }

        function spawnAsteroids(count) {
            for (let i = 0; i < count; i++) {
                let x, y;
                do {
                    x = Math.random() * canvas.width;
                    y = Math.random() * canvas.height;
                } while (Math.hypot(x - ship.x, y - ship.y) < 150);
                
                asteroids.push(createAsteroid(x, y, 3));
            }
        }

        function createAsteroid(x, y, size) {
            const speed = (4 - size) + Math.random();
            const angle = Math.random() * Math.PI * 2;
            
            return {
                x, y,
                velocityX: Math.cos(angle) * speed,
                velocityY: Math.sin(angle) * speed,
                size,
                radius: size * 15,
                vertices: generateVertices(size)
            };
        }

        function generateVertices(size) {
            const count = 8 + Math.floor(Math.random() * 5);
            const vertices = [];
            for (let i = 0; i < count; i++) {
                const angle = (i / count) * Math.PI * 2;
                const offset = 0.7 + Math.random() * 0.6;
                vertices.push({ angle, offset });
            }
            return vertices;
        }

        function gameLoop() {
            if (!gameRunning) return;
            
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function update() {
            // Ship controls
            if (keys['ArrowLeft'] || keys['KeyA']) ship.angle -= 0.08;
            if (keys['ArrowRight'] || keys['KeyD']) ship.angle += 0.08;
            if (keys['ArrowUp'] || keys['KeyW']) {
                ship.velocityX += Math.cos(ship.angle) * 0.15;
                ship.velocityY += Math.sin(ship.angle) * 0.15;
            }
            
            // Ship movement
            ship.x += ship.velocityX;
            ship.y += ship.velocityY;
            
            // Friction
            ship.velocityX *= 0.99;
            ship.velocityY *= 0.99;
            
            // Wrap around
            if (ship.x < 0) ship.x = canvas.width;
            if (ship.x > canvas.width) ship.x = 0;
            if (ship.y < 0) ship.y = canvas.height;
            if (ship.y > canvas.height) ship.y = 0;
            
            // Shooting
            if (keys['Space'] && !ship.shooting) {
                ship.shooting = true;
                bullets.push({
                    x: ship.x + Math.cos(ship.angle) * 20,
                    y: ship.y + Math.sin(ship.angle) * 20,
                    velocityX: Math.cos(ship.angle) * 8,
                    velocityY: Math.sin(ship.angle) * 8,
                    life: 60
                });
            }
            if (!keys['Space']) ship.shooting = false;
            
            // Invincibility
            if (ship.invincible > 0) ship.invincible--;
            
            // Update bullets
            bullets = bullets.filter(bullet => {
                bullet.x += bullet.velocityX;
                bullet.y += bullet.velocityY;
                bullet.life--;
                
                // Wrap
                if (bullet.x < 0) bullet.x = canvas.width;
                if (bullet.x > canvas.width) bullet.x = 0;
                if (bullet.y < 0) bullet.y = canvas.height;
                if (bullet.y > canvas.height) bullet.y = 0;
                
                return bullet.life > 0;
            });
            
            // Update asteroids
            asteroids.forEach(ast => {
                ast.x += ast.velocityX;
                ast.y += ast.velocityY;
                
                if (ast.x < 0) ast.x = canvas.width;
                if (ast.x > canvas.width) ast.x = 0;
                if (ast.y < 0) ast.y = canvas.height;
                if (ast.y > canvas.height) ast.y = 0;
            });
            
            // Bullet-asteroid collisions
            for (let i = bullets.length - 1; i >= 0; i--) {
                for (let j = asteroids.length - 1; j >= 0; j--) {
                    const bullet = bullets[i];
                    const ast = asteroids[j];
                    
                    if (Math.hypot(bullet.x - ast.x, bullet.y - ast.y) < ast.radius) {
                        bullets.splice(i, 1);
                        
                        score += (4 - ast.size) * 20;
                        updateDisplay();
                        
                        if (ast.size > 1) {
                            asteroids.push(createAsteroid(ast.x, ast.y, ast.size - 1));
                            asteroids.push(createAsteroid(ast.x, ast.y, ast.size - 1));
                        }
                        asteroids.splice(j, 1);
                        break;
                    }
                }
            }
            
            // Ship-asteroid collisions
            if (ship.invincible <= 0) {
                for (const ast of asteroids) {
                    if (Math.hypot(ship.x - ast.x, ship.y - ast.y) < ship.radius + ast.radius * 0.7) {
                        lives--;
                        updateDisplay();
                        
                        if (lives <= 0) {
                            gameOver();
                            return;
                        }
                        
                        ship.x = canvas.width / 2;
                        ship.y = canvas.height / 2;
                        ship.velocityX = 0;
                        ship.velocityY = 0;
                        ship.invincible = 120;
                        break;
                    }
                }
            }
            
            // Next level
            if (asteroids.length === 0) {
                spawnAsteroids(4 + Math.floor(score / 500));
            }
        }

        function draw() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw ship
            if (ship.invincible % 10 < 5 || ship.invincible <= 0) {
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.beginPath();
                
                const nose = {
                    x: ship.x + Math.cos(ship.angle) * 20,
                    y: ship.y + Math.sin(ship.angle) * 20
                };
                const left = {
                    x: ship.x + Math.cos(ship.angle + 2.5) * 15,
                    y: ship.y + Math.sin(ship.angle + 2.5) * 15
                };
                const right = {
                    x: ship.x + Math.cos(ship.angle - 2.5) * 15,
                    y: ship.y + Math.sin(ship.angle - 2.5) * 15
                };
                
                ctx.moveTo(nose.x, nose.y);
                ctx.lineTo(left.x, left.y);
                ctx.lineTo(ship.x, ship.y);
                ctx.lineTo(right.x, right.y);
                ctx.closePath();
                ctx.stroke();
                
                // Thrust
                if (keys['ArrowUp'] || keys['KeyW']) {
                    ctx.strokeStyle = '#ff6600';
                    ctx.beginPath();
                    ctx.moveTo(ship.x + Math.cos(ship.angle + 2.8) * 10, ship.y + Math.sin(ship.angle + 2.8) * 10);
                    ctx.lineTo(ship.x + Math.cos(ship.angle + Math.PI) * (15 + Math.random() * 10), 
                               ship.y + Math.sin(ship.angle + Math.PI) * (15 + Math.random() * 10));
                    ctx.lineTo(ship.x + Math.cos(ship.angle - 2.8) * 10, ship.y + Math.sin(ship.angle - 2.8) * 10);
                    ctx.stroke();
                }
            }
            
            // Draw asteroids
            ctx.strokeStyle = '#aaa';
            ctx.lineWidth = 2;
            asteroids.forEach(ast => {
                ctx.beginPath();
                ast.vertices.forEach((v, i) => {
                    const x = ast.x + Math.cos(v.angle) * ast.radius * v.offset;
                    const y = ast.y + Math.sin(v.angle) * ast.radius * v.offset;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                });
                ctx.closePath();
                ctx.stroke();
            });
            
            // Draw bullets
            ctx.fillStyle = '#fff';
            bullets.forEach(bullet => {
                ctx.beginPath();
                ctx.arc(bullet.x, bullet.y, 2, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        function drawStartScreen() {
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#fff';
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('üöÄ ASTEROIDS üöÄ', canvas.width / 2, canvas.height / 2 - 20);
            ctx.font = '16px Arial';
            ctx.fillText('Press Start to Play', canvas.width / 2, canvas.height / 2 + 20);
            ctx.textAlign = 'left';
        }

        function gameOver() {
            gameRunning = false;
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#ff6b6b';
            ctx.font = '30px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 20);
            ctx.fillStyle = '#fff';
            ctx.font = '20px Arial';
            ctx.fillText(`Score: ${score}`, canvas.width / 2, canvas.height / 2 + 20);
            ctx.textAlign = 'left';
            
            document.getElementById('startBtn').textContent = 'Play Again';
            document.getElementById('startBtn').disabled = false;
        }

        function updateDisplay() {
            document.getElementById('score').textContent = score;
            document.getElementById('lives').textContent = lives;
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        init();
    </script>
</body>
</html>
