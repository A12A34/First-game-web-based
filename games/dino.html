<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dino Run - Game Hub</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        .dino-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        canvas {
            border: 3px solid #535353;
            border-radius: 10px;
            background: #f7f7f7;
            transition: filter 0.5s;
        }
        canvas.night {
            filter: invert(1) hue-rotate(180deg);
        }
        .stats-bar {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .stat-box {
            text-align: center;
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
        }
        .stat-value.score { color: #00ff88; }
        .stat-value.high { color: #ffaa00; }
        .stat-value.coins { color: #ffd700; }
        .stat-label {
            font-size: 0.8rem;
            color: #888;
        }
        .power-ups {
            display: flex;
            gap: 15px;
        }
        .power-up {
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 1.5rem;
            opacity: 0.3;
            transition: all 0.3s;
        }
        .power-up.active {
            opacity: 1;
            box-shadow: 0 0 15px currentColor;
        }
        .power-up.shield { color: #00bfff; }
        .power-up.slow { color: #ff69b4; }
        .power-up.magnet { color: #ffd700; }
        .power-up.double-jump { color: #9370db; }
        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            cursor: pointer;
            font-size: 1.5rem;
        }
        .controls-hint {
            color: #888;
            font-size: 0.9rem;
        }
        .shop-btn {
            background: #ffd700;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <button id="fullscreenBtn" class="fullscreen-btn" title="Toggle Fullscreen">‚õ∂</button>
    <div class="container">
        <a href="../index.html" class="back-btn">‚Üê Back to Games</a>
        
        <div class="game-container">
            <h1 class="game-title">ü¶ñ Dino Run</h1>
            
            <div class="dino-container">
                <div class="stats-bar">
                    <div class="stat-box">
                        <div class="stat-value score" id="score">0</div>
                        <div class="stat-label">Score</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value high" id="highScore">0</div>
                        <div class="stat-label">High Score</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value coins" id="totalCoins">0</div>
                        <div class="stat-label">ü™ô Coins</div>
                    </div>
                </div>
                
                <div class="power-ups">
                    <div class="power-up shield" id="shieldPower" title="Shield">üõ°Ô∏è</div>
                    <div class="power-up slow" id="slowPower" title="Slow Motion">‚è±Ô∏è</div>
                    <div class="power-up double-jump" id="doubleJumpPower" title="Double Jump">‚¨ÜÔ∏è</div>
                    <div class="power-up magnet" id="magnetPower" title="Coin Magnet">üß≤</div>
                </div>
                
                <canvas id="gameCanvas" width="1050" height="375"></canvas>
                
                <p class="controls-hint">SPACE/UP: Jump (tap twice for double jump!) | DOWN: Duck | You can jump while ducking!</p>
                
                <button id="startBtn" class="btn btn-primary">Start Game</button>
            </div>
            
            <div class="instructions">
                <h3>How to Play</h3>
                <p>Jump over cacti and duck under birds! Collect coins and power-ups. The game speeds up as you go!</p>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        const GROUND_Y = 190;
        const GRAVITY = 0.9;
        const JUMP_FORCE = -15;
        
        let dino = {
            x: 50,
            y: GROUND_Y,
            width: 44,
            height: 50,
            velocityY: 0,
            isJumping: false,
            isDucking: false,
            jumpCount: 0,
            maxJumps: 1
        };
        
        let obstacles = [];
        let clouds = [];
        let coins = [];
        let powerUpItems = [];
        let score = 0;
        let highScore = 0;
        let totalCoins = 0;
        let gameSpeed = 6;
        let gameRunning = false;
        let groundOffset = 0;
        let isNight = false;
        let nightTimer = 0;
        
        // Active power-ups
        let activePowers = {
            shield: false,
            slow: false,
            doubleJump: false,
            magnet: false
        };
        let powerTimers = {};

        function init() {
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);
            
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
            canvas.addEventListener('touchstart', handleTouch);
            
            // Load saves
            highScore = parseInt(localStorage.getItem('dinoHighScore') || '0');
            totalCoins = parseInt(localStorage.getItem('dinoCoins') || '0');
            document.getElementById('highScore').textContent = highScore;
            document.getElementById('totalCoins').textContent = totalCoins;
            
            drawStartScreen();
        }

        function handleKeyDown(e) {
            if (e.code === 'Space' || e.code === 'ArrowUp' || e.code === 'KeyW') {
                e.preventDefault();
                if (!gameRunning) startGame();
                else jump();
            }
            if (e.code === 'ArrowDown' || e.code === 'KeyS') {
                e.preventDefault();
                if (!dino.isJumping) {
                    dino.isDucking = true;
                }
            }
        }

        function handleKeyUp(e) {
            if (e.code === 'ArrowDown' || e.code === 'KeyS') {
                dino.isDucking = false;
            }
        }
        
        function handleTouch(e) {
            e.preventDefault();
            if (!gameRunning) startGame();
            else jump();
        }

        function jump() {
            const maxJumps = activePowers.doubleJump ? 2 : dino.maxJumps;
            
            // Allow jumping while ducking
            if (dino.isDucking && !dino.isJumping) {
                dino.isDucking = false;
            }
            
            if (dino.jumpCount < maxJumps) {
                dino.velocityY = JUMP_FORCE;
                dino.isJumping = true;
                dino.jumpCount++;
            }
        }

        function startGame() {
            dino.y = GROUND_Y;
            dino.velocityY = 0;
            dino.isJumping = false;
            dino.isDucking = false;
            dino.jumpCount = 0;
            dino.height = 50;
            
            obstacles = [];
            clouds = [];
            coins = [];
            powerUpItems = [];
            score = 0;
            gameSpeed = 6;
            gameRunning = true;
            isNight = false;
            nightTimer = 0;
            
            // Reset powers
            for (const power in activePowers) {
                activePowers[power] = false;
                clearTimeout(powerTimers[power]);
            }
            updatePowerDisplay();
            
            canvas.classList.remove('night');
            
            document.getElementById('startBtn').textContent = 'Playing...';
            document.getElementById('startBtn').disabled = true;
            
            // Add initial clouds
            for (let i = 0; i < 3; i++) {
                clouds.push({
                    x: 200 + i * 200,
                    y: 30 + Math.random() * 50,
                    speed: 1 + Math.random()
                });
            }
            
            gameLoop();
        }

        function gameLoop() {
            if (!gameRunning) return;
            
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        function update() {
            const speedMult = activePowers.slow ? 0.5 : 1;
            const currentSpeed = gameSpeed * speedMult;
            
            // Day/Night cycle
            nightTimer++;
            if (nightTimer % 1000 === 0) {
                isNight = !isNight;
                canvas.classList.toggle('night', isNight);
            }
            
            // Dino physics
            if (dino.isDucking && !dino.isJumping) {
                dino.height = 30;
                dino.y = GROUND_Y + 20;
            } else {
                dino.height = 50;
                if (dino.isJumping) {
                    dino.velocityY += GRAVITY;
                    dino.y += dino.velocityY;
                    
                    if (dino.y >= GROUND_Y) {
                        dino.y = GROUND_Y;
                        dino.velocityY = 0;
                        dino.isJumping = false;
                        dino.jumpCount = 0;
                    }
                }
            }
            
            // Spawn obstacles
            if (obstacles.length === 0 || obstacles[obstacles.length - 1].x < canvas.width - 250 - Math.random() * 200) {
                spawnObstacle();
            }
            
            // Spawn coins
            if (Math.random() < 0.02 && (coins.length === 0 || coins[coins.length - 1].x < canvas.width - 100)) {
                spawnCoin();
            }
            
            // Spawn power-ups
            if (Math.random() < 0.003 && powerUpItems.length < 1) {
                spawnPowerUp();
            }
            
            // Update obstacles
            obstacles = obstacles.filter(obs => {
                obs.x -= currentSpeed;
                return obs.x > -obs.width;
            });
            
            // Update coins
            coins = coins.filter(coin => {
                coin.x -= currentSpeed;
                
                // Magnet effect
                if (activePowers.magnet) {
                    const dx = dino.x - coin.x;
                    const dy = dino.y - coin.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    if (dist < 150) {
                        coin.x += dx * 0.1;
                        coin.y += dy * 0.1;
                    }
                }
                
                // Collect
                if (checkCollision(dino, { x: coin.x - 10, y: coin.y - 10, width: 20, height: 20 })) {
                    totalCoins++;
                    score += 50;
                    document.getElementById('totalCoins').textContent = totalCoins;
                    localStorage.setItem('dinoCoins', totalCoins);
                    return false;
                }
                
                return coin.x > -20;
            });
            
            // Update power-ups
            powerUpItems = powerUpItems.filter(power => {
                power.x -= currentSpeed;
                
                if (checkCollision(dino, { x: power.x - 15, y: power.y - 15, width: 30, height: 30 })) {
                    activatePower(power.type);
                    return false;
                }
                
                return power.x > -30;
            });
            
            // Update clouds
            clouds.forEach(cloud => {
                cloud.x -= cloud.speed * speedMult;
                if (cloud.x < -50) {
                    cloud.x = canvas.width + 50;
                    cloud.y = 30 + Math.random() * 50;
                }
            });
            
            // Collision detection
            if (!activePowers.shield) {
                for (const obs of obstacles) {
                    if (checkCollision(dino, obs)) {
                        gameOver();
                        return;
                    }
                }
            }
            
            // Update score and speed
            score++;
            if (score % 100 === 0 && gameSpeed < 15) {
                gameSpeed += 0.3;
            }
            
            document.getElementById('score').textContent = Math.floor(score / 10);
            
            groundOffset = (groundOffset + currentSpeed) % 20;
        }

        function spawnObstacle() {
            const types = ['cactus', 'cactus', 'cactus', 'cactus', 'bird'];
            const type = types[Math.floor(Math.random() * types.length)];
            
            if (type === 'cactus') {
                const height = 35 + Math.random() * 30;
                const isDouble = Math.random() < 0.3;
                obstacles.push({
                    x: canvas.width,
                    y: GROUND_Y + 50 - height,
                    width: isDouble ? 40 : 25,
                    height: height,
                    type: 'cactus',
                    isDouble
                });
            } else {
                // Bird at different heights
                const heights = [GROUND_Y - 60, GROUND_Y - 30, GROUND_Y];
                obstacles.push({
                    x: canvas.width,
                    y: heights[Math.floor(Math.random() * heights.length)],
                    width: 45,
                    height: 30,
                    type: 'bird'
                });
            }
        }
        
        function spawnCoin() {
            coins.push({
                x: canvas.width,
                y: GROUND_Y - 20 - Math.random() * 60,
                rotation: 0
            });
        }
        
        function spawnPowerUp() {
            const types = ['shield', 'slow', 'doubleJump', 'magnet'];
            powerUpItems.push({
                x: canvas.width,
                y: GROUND_Y - 40 - Math.random() * 40,
                type: types[Math.floor(Math.random() * types.length)]
            });
        }
        
        function activatePower(type) {
            activePowers[type] = true;
            updatePowerDisplay();
            
            clearTimeout(powerTimers[type]);
            powerTimers[type] = setTimeout(() => {
                activePowers[type] = false;
                updatePowerDisplay();
            }, type === 'shield' ? 5000 : 8000);
        }
        
        function updatePowerDisplay() {
            document.getElementById('shieldPower').classList.toggle('active', activePowers.shield);
            document.getElementById('slowPower').classList.toggle('active', activePowers.slow);
            document.getElementById('doubleJumpPower').classList.toggle('active', activePowers.doubleJump);
            document.getElementById('magnetPower').classList.toggle('active', activePowers.magnet);
        }

        function checkCollision(a, b) {
            const padding = 8;
            return a.x + padding < b.x + b.width - padding &&
                   a.x + a.width - padding > b.x + padding &&
                   a.y + padding < b.y + b.height - padding &&
                   a.y + a.height - padding > b.y + padding;
        }

        function draw() {
            // Clear
            ctx.fillStyle = isNight ? '#1a1a2e' : '#f7f7f7';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw clouds
            ctx.fillStyle = isNight ? '#333' : '#ddd';
            clouds.forEach(cloud => {
                ctx.beginPath();
                ctx.arc(cloud.x, cloud.y, 20, 0, Math.PI * 2);
                ctx.arc(cloud.x + 25, cloud.y - 5, 15, 0, Math.PI * 2);
                ctx.arc(cloud.x + 45, cloud.y, 18, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw ground
            ctx.fillStyle = isNight ? '#444' : '#535353';
            ctx.fillRect(0, GROUND_Y + 50, canvas.width, 3);
            
            // Ground texture
            ctx.fillStyle = isNight ? '#555' : '#888';
            for (let x = -groundOffset; x < canvas.width; x += 20) {
                ctx.fillRect(x, GROUND_Y + 56, 10, 2);
            }
            
            // Draw coins
            ctx.fillStyle = '#ffd700';
            coins.forEach(coin => {
                coin.rotation += 0.1;
                ctx.save();
                ctx.translate(coin.x, coin.y);
                ctx.scale(Math.cos(coin.rotation), 1);
                ctx.beginPath();
                ctx.arc(0, 0, 12, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#ffaa00';
                ctx.beginPath();
                ctx.arc(0, 0, 7, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#ffd700';
                ctx.restore();
            });
            
            // Draw power-ups
            powerUpItems.forEach(power => {
                ctx.font = '24px Arial';
                ctx.textAlign = 'center';
                const icons = { shield: 'üõ°Ô∏è', slow: '‚è±Ô∏è', doubleJump: '‚¨ÜÔ∏è', magnet: 'üß≤' };
                ctx.fillText(icons[power.type], power.x, power.y);
            });
            
            // Draw dino
            if (activePowers.shield) {
                ctx.fillStyle = 'rgba(0, 191, 255, 0.3)';
                ctx.beginPath();
                ctx.arc(dino.x + dino.width/2, dino.y + dino.height/2, 40, 0, Math.PI * 2);
                ctx.fill();
            }
            
            ctx.fillStyle = isNight ? '#00ff88' : '#535353';
            if (dino.isDucking) {
                // Ducking dino
                ctx.fillRect(dino.x, dino.y, dino.width + 15, dino.height);
                // Eye
                ctx.fillStyle = '#fff';
                ctx.fillRect(dino.x + 42, dino.y + 5, 10, 10);
                ctx.fillStyle = isNight ? '#ff6b6b' : '#000';
                ctx.fillRect(dino.x + 47, dino.y + 7, 5, 5);
            } else {
                // Standing dino body
                ctx.fillRect(dino.x, dino.y, dino.width, dino.height);
                // Head
                ctx.fillRect(dino.x + 22, dino.y - 18, 28, 28);
                // Eye
                ctx.fillStyle = '#fff';
                ctx.fillRect(dino.x + 36, dino.y - 12, 10, 10);
                ctx.fillStyle = isNight ? '#ff6b6b' : '#000';
                ctx.fillRect(dino.x + 40, dino.y - 10, 5, 5);
                
                // Animated legs
                ctx.fillStyle = isNight ? '#00ff88' : '#535353';
                const legOffset = dino.isJumping ? 0 : Math.sin(Date.now() / 50) * 6;
                ctx.fillRect(dino.x + 8, dino.y + dino.height, 10, 18 + legOffset);
                ctx.fillRect(dino.x + 26, dino.y + dino.height, 10, 18 - legOffset);
                
                // Tail
                ctx.fillRect(dino.x - 12, dino.y + 15, 15, 12);
                
                // Arms
                ctx.fillRect(dino.x + 35, dino.y + 20, 8, 15);
            }
            
            // Draw obstacles
            obstacles.forEach(obs => {
                if (obs.type === 'cactus') {
                    ctx.fillStyle = isNight ? '#00cc6a' : '#2d5016';
                    ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
                    // Spikes
                    if (obs.width > 30 || obs.isDouble) {
                        ctx.fillRect(obs.x - 10, obs.y + 12, 10, 6);
                        ctx.fillRect(obs.x + obs.width, obs.y + 18, 10, 6);
                    }
                } else {
                    // Bird
                    ctx.fillStyle = isNight ? '#ff6b6b' : '#535353';
                    ctx.fillRect(obs.x + 12, obs.y + 12, 28, 18);
                    // Wings (animated)
                    const wingY = Math.sin(Date.now() / 80) * 8;
                    ctx.fillRect(obs.x, obs.y + wingY + 5, 18, 10);
                    ctx.fillRect(obs.x + 28, obs.y + wingY + 5, 18, 10);
                    // Beak
                    ctx.fillStyle = '#ff6b6b';
                    ctx.fillRect(obs.x + 40, obs.y + 15, 10, 6);
                    // Eye
                    ctx.fillStyle = '#fff';
                    ctx.fillRect(obs.x + 32, obs.y + 14, 6, 6);
                }
            });
            
            // Score milestone flash
            if (Math.floor(score / 10) % 100 === 0 && score > 0 && score % 10 < 30) {
                ctx.fillStyle = 'rgba(255, 215, 0, 0.3)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
        }

        function drawStartScreen() {
            ctx.fillStyle = '#f7f7f7';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#535353';
            ctx.font = 'bold 28px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('ü¶ñ Press SPACE or Tap to Start', canvas.width / 2, canvas.height / 2 - 20);
            
            ctx.font = '16px Arial';
            ctx.fillStyle = '#888';
            ctx.fillText('Collect coins and power-ups! Double jump available!', canvas.width / 2, canvas.height / 2 + 20);
            
            ctx.fillStyle = '#535353';
            ctx.fillRect(0, GROUND_Y + 50, canvas.width, 3);
        }

        function gameOver() {
            gameRunning = false;
            
            // Update high score
            const finalScore = Math.floor(score / 10);
            if (finalScore > highScore) {
                highScore = finalScore;
                localStorage.setItem('dinoHighScore', highScore);
                document.getElementById('highScore').textContent = highScore;
            }
            
            // Draw game over
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#fff';
            ctx.font = 'bold 36px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('GAME OVER', canvas.width / 2, canvas.height / 2 - 30);
            ctx.font = '24px Arial';
            ctx.fillText(`Score: ${finalScore}`, canvas.width / 2, canvas.height / 2 + 10);
            ctx.font = '18px Arial';
            ctx.fillStyle = '#ffd700';
            ctx.fillText(`Total Coins: ${totalCoins} ü™ô`, canvas.width / 2, canvas.height / 2 + 45);
            
            document.getElementById('startBtn').textContent = 'Play Again';
            document.getElementById('startBtn').disabled = false;
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        init();
    </script>
</body>
</html>
